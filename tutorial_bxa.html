<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Using academicons -->
  <!-- <link rel="stylesheet" href="assets/academicons-1.9/css/academicons.min.css"/> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <!-- Using fontawesome -->
  <script src="https://kit.fontawesome.com/f5e5434f52.js" crossorigin="anonymous"></script>


  <!-- <link rel="apple-touch-icon" href="./favicon.ico" /> -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>BXA Tutorial</title>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
  <!-- <meta content="" name="description"> -->
  <!-- <meta content="" name="keywords"> -->
  <meta property="og:title" content="BXA Tutorial" />
  <meta property="og:locale" content="en_UK" />
  <meta name="description" content="BXA Tutorial" />
  <meta property="og:description" content="BXA Tutorial" />
  <link rel="canonical" href="https://peterboorman.com/" />
  <meta property="og:url" content="https://peterboorman.com/" />
  <meta property="og:site_name" content="BXA Tutorial" />
  <script type="application/ld+json">
  {"@type":"WebSite","headline":"BXA Tutorial","url":"https://peterboorman.com/tutorial_bxa.html","description":"BXA Tutorial","name":"BXA Tutorial","@context":"https://schema.org"}</script>

  <!-- Favicons -->
  <!-- <link href="assets/img/favicon.png" rel="icon"> -->
  <link href="favicon.ico" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: iPortfolio - v1.4.1
  * Template URL: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <div class="progressContainer"><div id="progress" class="progress"></div></div>


  <!-- ======= Mobile nav toggle button ======= -->
  <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">
      <div class="profile">
        <a href="http://johannesbuchner.github.io/BXA/xspec-analysis.html#parameter-posterior-plots" target="_blank"><img src="figures/plots_logo.png" alt="" class="img-fluid rounded-circle"></img></a>
        <p></p>
        <h1 class="specific"><a href="#welcome">BXA Tutorial</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="http://johannesbuchner.github.io/BXA/" class="github"><i class="bx bxl-github"></i></a>
          <a href="#contact"><i class="bx bx-envelope"></i></a>
        </div>
      </div>

      <nav class="nav-menu">
        <ul>
          <li><a href="#welcome"><i class="bx bx-star"></i> <span>Welcome</span></a></li>
          <li><a href="#bxa-motivation"><i class="icofont-light-bulb"></i> <span>Why use BXA?</span></a></li>
          <li><a href="#setup"><i class="icofont-tools-alt-2"></i> <span>Setup</span></a></li>
          <li><a href="#links"><i class="bx bx-bookmarks"></i> <span>Useful links</span></a></li>
          <li><a href="#session0"><i class="bx bx-terminal"></i>Session 0 - X-ray spectral fitting</a></li>
          <li><a href="#ex01"><i class="bx bx-chevron-right"></i>0.1 - fitting</a></li>
          <li><a href="#session1"><i class="bx bx-terminal"></i>Session 1 - BXA</a></li>
          <li><a href="#ex11"><i class="bx bx-chevron-right"></i>1.1 - priors</a></li>
          <li><a href="#ex12"><i class="bx bx-chevron-right"></i>1.2 - fitting</a></li>
          <li><a href="#ex13"><i class="bx bx-chevron-right"></i>1.3 - model comparison</a></li>
          <li><a href="#ex14"><i class="bx bx-chevron-right"></i>1.4 - error propagation</a></li>
          <li><a href="#ex15"><i class="bx bx-chevron-right"></i>1.5 - visualisation</a></li>
          <li><a href="#ex16"><i class="bx bx-chevron-right"></i>1.6 - multiple spectra</a></li>
          <li><a href="#ex17"><i class="bx bx-chevron-right"></i>1.7 - background fitting</a></li>
          <li><a href="#session2"><i class="bx bx-bar-chart-alt-2"></i> <span>Session 2 - more advanced</span></a></li>
          <li><a href="#ex21"><i class="bx bx-chevron-right"></i> <span>2.1 - simulations & calibration</span></a></li>
          <li><a href="#ex22"><i class="bx bx-chevron-right"></i> <span>2.2 - model verification</span></a></li>
          <li><a href="#ex23"><i class="bx bx-chevron-right"></i> <span>2.3 - BHM introduction</span></a></li>
          <li><a href="#ex24"><i class="bx bx-chevron-right"></i> <span>2.4 - BHM continued</span></a></li>
          <li><a href="#tipsandtricks"><i class="bx bx-bulb"></i> <span>Tips & tricks</span></a></li>
          <li><a href="#contact"><i class="icofont-letter"></i>Contact</a></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
        </ul>
      </nav><!-- .nav-menu -->
      <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

    </div>
    </div>
  </header><!-- End Header -->

  <main id="main">

<!-- ======= Welcome Section ======= -->
    <section id="welcome" class="about">
      <div class="container">
        <div class="section-title">
            <h1><i class="bx bx-star"></i>&nbsp; <span class="typed" data-typed-items="Hello!, Dobrý den!, Kon'nichiwa!, Hallo!, Ciao!, Hola!, Mholweni!, Sawubona!, Marhaba!, Nǐ hǎo!, God dag!, Bonjour!, Shalom!, Namaste!, Zdravstvuyte!, Zdravo!, Ahoj!, Hallå!, Annyeonghaseyo!, Tena jistilign!, Moni!, Salama alaikum!, Ndêwó, Muraho!, Mbote!, Ki kati!, Malagasy!, Miarahaba!, Salibonani!, Dumêlang!, Ashamaa!, Dumela!, Mhoro!, Jambo!, Sawubona!, Selam!, Avuxeni!, Dumela!, Salaam aleekum, Molo!, Bawo!, Barev dzez!, Salam!, Assalamualaikum!, Nômoshkar!, Mingalarba!, Chum reap suor!, Néih hóu!, Kuzu-zangpo!, Gamarjoba!, Halo!, Salamatsyzby!, Sabaidee!, Namaskaram!, Sain baina uu!, Salaam!, Sat sri akal ji!, Āyubōvan!, Lí-hó!, Vaṇakkam!, Isänmesez!, Namaskārām!, Sà-wàt-dee!, Tashi delek!, Āssālam ‘alaykum!, Ässalamu läykum!, Assalomu aleykum!, Xin chào!, Tungjatjeta!, Kaixo!, Vitaju!, Demat!, Dobar dan!, Bok!, Tere!, Hyvää päivää!, Goeie!, Dia duit!, Halò!, Guten tag!, Yasass!, Szervusz!, Góðan dag!, Buon giorno!, Sveika!, Labas!, Moïen!, Dzień dobry!, Salut!, Živjo!, Dobriy den!, Helo!, A gutn tog!, As-salām ‘alaykum!, Merheba!, Merhaba!, Ni sa bula!, Aloha!, Tēnā koe!, Yokwe!, Alii!, Tālofa!, Ia ora na!, Gude!, Mālō e lelei!"></span></h1>
            <h3>Welcome to the <a target="_blank" href="https://github.com/JohannesBuchner/BXA">Bayesian X-ray Analysis (BXA)</a> tutorial page.</h3>
            </br>
          <p>BXA connects <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/index.html">PyXspec</a>/<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/">Sherpa</a> to <a target="_blank" href="https://johannesbuchner.github.io/UltraNest/method.html">nested sampling algorithms</a> for Bayesian parameter estimation and model comparison with the Bayesian evidence.</p>
          <div class="col-lg-16">
            <a target="_blank" href="https://en.wikipedia.org/wiki/Bayes%27_theorem"><img src="bxa//bayestheorem.png" class="img-fluid" alt=""></a>
          </div>
          </br>
          If you have any questions/comments/suggestions concerning the tutorial, please <a href="#contact">get in touch</a>!
        </div>
      </div>
    </section>
<!-- End Welcome Section -->

<section id="bxa-motivation" class="services">
      <div class="container">
        <div class="section-title">
          <h2><i class="icofont-light-bulb"></i> Why use BXA? <a class="headerlink" href="#bxa-motivation" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
          <p>Key strengths:</p>
          <ul>
            <li>Systematic fitting with minimal user input of initial parameters</li>
            <li>Efficient to systematically fit large datasets with many sources or compare many models</li>
            <li>Provides accurate parameter constraints, even for (very) low counts or for complex parameter spaces with strong degeneracies</li>
          </ul>
        
        For the full list of features and strengths available, see <a target="_blank" href="https://github.com/JohannesBuchner/BXA">BXA's documentation</a>. Here, we focus on two specific scenarios.
        </div>

        <div class="row">
          <h4>Parameter space constraints in the (very) low count regime</h4>
          <p>BXA is capable of accurately estimating parameter confidence contours, even when no source counts are present. In this figure, a series of obscured accreting supermassive black hole (ak AGN)
           spectra are simulated (left panel). The right panel then shows the BXA_derived confidence contours for intrinsic line of sight obscuring column density (log <i>N</i><sub>H</sub>) vs. intrinsic 
           (i.e. unabsorbed) X-ray luminosity in the 2-10 keV band.
           <br>
           By simultaneously fitting the background and source spectra, BXA is able to derive a confidence contour for low count spectra even down to zero source counts (though the constraint is very poor, 
           as expected). The contour found makes sense, since an unobscured AGN (i.e. log <i>N</i><sub>H</sub> ~ 20) should have been detected if it were very bright. This is why the upper left portion of 
         the contour plane is always ruled out.</p>
           <br><br>
          <div class="col-lg-12">
            <img src="figures/bxa_gif.gif" class="img-fluid" alt="">
          </div>
        </div>

        <br><br>

        <div class="row">
          <h4>No need for fine-tuning initial parameters</h4>
          BXA does not require a single pre-defined position in the parameter space to start exploring. In this figure, a series of X-ray spectra are simulated at incrementally brighter fluxes. 
          The right panel shows the confidence contour between two parameters in the simulations - black hole spin vs. the height of the X-ray emitting source above the black hole 
          (assuming the lamp post geometry). Both parameters were assigned uninformative priors before fitting over a wide range of possible values. The size and shape of the confidence contours 
          found are thus independent of any single initial parameter values.
          <br><br>
          <div class="col-lg-12">
            <img src="figures/kyn_gif.gif" class="img-fluid" alt="">
          </div>
        </div>

    

        </div>
</section>


<section id="setup" class="services">
      <div class="container">
        <div class="section-title">
          <h2><i class="icofont-tools-alt-2"></i> Setup <a class="headerlink" href="#setup" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>

          <h3>&#9888;&#65039; <font color="red">WARNING!</font> &#9888;&#65039; BXA requires a working form of <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/index.html">PyXspec</a> and/or <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/">Sherpa</a>.</h3>
          <p>Make sure either of these are installed before doing the exercises! Also note the exercises were written for BXA v4.0.5 - if some commands are not working as expected, check which version you are running.</p>
          </br>

          <h3>For PyXspec users</h3>
          First, install PyXspec:
          <ul>
          <li>Using PyXspec requires a source distribution of HEASoft. See install instructions here:<br/><a target="_blank" href="https://heasarc.gsfc.nasa.gov/docs/software/heasoft/">https://heasarc.gsfc.nasa.gov/docs/software/heasoft/</a><br/></li>
          </ul>

          We advise using a conda environment (e.g. with <a target="_blank" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a>) to ensure no conflicts occur when installing the Python packages required for BXA. If you have not created a dedicated BXA conda environment before:
          <ul>
          <li>Create a new conda environment:</br>
            <code>$ conda create -n xspecbxa python=3.8</code>&nbsp; <button class="cpbt" onclick="cx('conda create -n xspecbxa python=3.8')"><i class="icofont-copy"></i></button></li>
          <li>Activate the new environment:</br>
            <code>$ conda activate xspecbxa</code>&nbsp; <button class="cpbt" onclick="cx('conda activate xspecbxa')"><i class="icofont-copy"></i></button></li>
          <li>Install packages:</br>
            <code>$ pip install requests corner astropy h5py cython scipy tqdm</code>&nbsp; <button class="cpbt" onclick="cx('pip install requests corner astropy h5py cython scipy tqdm')"><i class="icofont-copy"></i></button></li>
          <li>Install BXA:</br>
            <code>$ pip install bxa</code>&nbsp; <button class="cpbt" onclick="cx('pip install bxa')"><i class="icofont-copy"></i></button></li>
          </ul>

          Once the install process has finished, check everthing is installed and works as required:&nbsp; <button class="cpbt" onclick="cx('python -c \'import xspec\'\npython -c \'import ultranest\'\npython -c \'import bxa.xspec as bxa\'')"><i class="icofont-copy"></i></button>
          <ul>
            <li>Check PyXspec works:
              <br>
              <code>$ python -c 'import xspec'</code></li>
            <li>Check UltraNest works:
              <br>
              <code>$ python -c 'import ultranest'</code></li>
            <li>Check BXA works:
              <br>
              <code>$ python -c 'import bxa.xspec as bxa'</code></li>
          </ul>
          If no error messages come up from these commands, BXA and PyXspec should work.

        </br></br>

          <h3>For Sherpa users</h3>
          <ul>
          <li>First, install CIAO and Sherpa in a conda environment:<br/><a target="_blank" href="https://cxc.cfa.harvard.edu/ciao/download/">https://cxc.cfa.harvard.edu/ciao/download/</a><br/></li>
          <li>Once the install process has finished, check Sherpa works:</br>
          <code><pre>
$ conda activate ciao-environment-name
$ sherpa</pre></code> <button class="cpbt" onclick="cx('conda activate ciao-environment-name\nsherpa')"><i class="icofont-copy"></i></button></br><!-- &nbsp; <button class="cpbt" onclick="cx('conda activate ciao-environment-name')"><i class="icofont-copy"></i></button><br/> -->

          If there are no errors, Sherpa should be working as expected.
          </li>
        </ul>

        Then install BXA inside the CIAO conda environment:
        <ul>
          <li>Activate the environment:
            <br>
            <code>$ conda activate ciao-environment-name</code>&nbsp; <button class="cpbt" onclick="cx('conda activate ciao-environment-name')"><i class="icofont-copy"></i></button></li>
          <li>Install packages:
            <br>
            <code>$ pip install requests corner astropy h5py cython scipy tqdm</code>&nbsp; <button class="cpbt" onclick="cx('pip install requests corner astropy h5py cython scipy tqdm')"><i class="icofont-copy"></i></button></li>
          <li>Install:
            <br>
            <code>$ pip install bxa</code>&nbsp; <button class="cpbt" onclick="cx('pip install bxa')"><i class="icofont-copy"></i></button></li>
          </ul>

          Once the install process has finished, check everthing works as required:
          <ul>
            <li>Check UltraNest works:
              <br>
              <code>$ python -c 'import ultranest'</code></li>
            <li>Check BXA works:
              <br>
              <code>$ python -c 'import bxa.sherpa as bxa'</code>&nbsp; <button class="cpbt" onclick="cp('python -c \'import ultranest\'\npython -c \'import bxa.sherpa as bxa\'')"><i class="icofont-copy"></i></button></li>
          </ul>
          If no error messages come up from these commands, BXA and PyXspec should work.

        </div>
      </div>
</section>

<section id="links" class="services">
      <div class="container">

        <div class="section-title">
          <h2><i class="bx bx-bookmarks"></i> Useful links <a class="headerlink" href="#links" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
          <h4>Documentation</h4>
          <ul>
          <li>Xspec &amp; PyXspec documentation:<br/><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/">https://heasarc.gsfc.nasa.gov/xanadu/xspec/</a>
          </li>
          <li>Sherpa reference for commands:<br/><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/sherpa4.html">https://cxc.cfa.harvard.edu/sherpa/ahelp/sherpa4.html</a>
          </li>
          <li>UltraNest documentation:<br><a target="_blank" href="https://johannesbuchner.github.io/UltraNest/readme.html">https://johannesbuchner.github.io/UltraNest/readme.html</a>
          </li>
          <li>BXA documentation:</br>
            <a href="https://johannesbuchner.github.io/BXA/index.html" target="_blank">https://johannesbuchner.github.io/BXA/index.html</a>
          </li>
        </ul>


          
          <h4>Places to ask questions</h4>
          <ul>
          <li>Xspec Facebook group:<br/><a target="_blank" href="https://www.facebook.com/groups/320119452570/?ref=share">https://www.facebook.com/groups/320119452570/?ref=share</a>
          </li>
          <li>Astrostatistics Facebook group:<br/><a target="_blank" href="https://www.facebook.com/groups/astro.r/?ref=share">https://www.facebook.com/groups/astro.r/?ref=share</a>
          </li>
          <li><a href="#contact">Email</a>!</li>
        </ul>

          
          <h4>Useful papers & documents</h4>
        <ul>
          <li>X-ray Data Primer by CXC:<br/><a target="_blank" href="https://cxc.cfa.harvard.edu/cdo/xray_primer.pdf">https://cxc.cfa.harvard.edu/cdo/xray_primer.pdf</a>
          </li>
          <li>Information on C-statistics (&amp; modified C-statistics, aka W-stat) used in Xspec &amp; Sherpa by Giacomo Vianello:<br/><a target="_blank" href="https://giacomov.github.io/Bias-in-profile-poisson-likelihood/">https://giacomov.github.io/Bias-in-profile-poisson-likelihood/</a>
          </li>
          <li>Nested sampling review - Buchner (2021)<br><a target="_blank" href="https://arxiv.org/abs/2101.09675">https://arxiv.org/abs/2101.09675</a>
          </li>
          <li>PCA background - Simmonds et al., (2018, A&A)<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2018A%26A...618A..66S/abstract">https://ui.adsabs.harvard.edu/abs/2018A%26A...618A..66S/abstract</a>
          </li>
          <li>Simulation-based calibration of false-positive & false-negative rates - Baronchelli et al., (2018, MNRAS)<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2018MNRAS.480.2377B/abstract">https://ui.adsabs.harvard.edu/abs/2018MNRAS.480.2377B/abstract</a>
          </li>
          <li>Bayesian Hierarchical Modelling with BXA:
          <ul>
          <li>Baronchelli et al., (2020, MNRAS), Section A1<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2020MNRAS.498.5284B/abstract">https://ui.adsabs.harvard.edu/abs/2020MNRAS.498.5284B/abstract</a></li>
          <li>Kuraszkiewicz et al., (2021, ApJ), Section A1<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2021ApJ...913..134K/abstract">https://ui.adsabs.harvard.edu/abs/2021ApJ...913..134K/abstract</a></li>
          <li>Liu et al., (2021, arXiv), Section 3.7<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2021arXiv210614522L/abstract">https://ui.adsabs.harvard.edu/abs/2021arXiv210614522L/abstract</a></li>
          </ul>
        </li>
        </ul>


          <h4>Lectures & videos</h4>
          <ul>
            <li>BiD4BEST Bayesian X-ray Spectral Analysis lectures by Johannes Buchner:<br/>
              <ol>
              <li><a target="_blank" href="https://youtu.be/_r4ecpje7nE">https://youtu.be/_r4ecpje7nE</a></li>
              <li><a href="https://youtu.be/EIzhDG-0Ji8">https://youtu.be/EIzhDG-0Ji8</a></li>
            </ol>
          </li>
            <li>Graduate-level course: <i>Monte Carlo inference methods</i> by Johannes Buchner:</br>
            <ol>
            <li><i>Bayesian inference workflow in astronomy and physics</i>:</br>
              <a href="https://youtu.be/D2P6xBR_2bQ" target="_blank">https://youtu.be/D2P6xBR_2bQ</a></li>
            <li><i>Bayesian model comparison, curse of dimensionality, Importance Sampling</i>:</br>
              <a href="https://youtu.be/TfaGfFnsmW8" target="_blank">https://youtu.be/TfaGfFnsmW8</a></li>
            <li><i>Markov Chain Monte Carlo (MCMC) and diagnostics</i>:</br>
              <a href="https://youtu.be/YA6Ezh8CsrY" target="_blank">https://youtu.be/YA6Ezh8CsrY</a></li>
            <li><i>Hamiltonian Monte Carlo (HMC) by Dr. Francesca Capel</i>:</br>
              <a href="https://youtu.be/nmHGyXsiaeI" target="_blank">https://youtu.be/nmHGyXsiaeI</a></li>
            <li><i>Nested Sampling from scratch - Practical Inference for Researchers in the Physical Sciences</i>:</br>
              <a href="https://youtu.be/baLFl_4ZwXw" target="_blank">https://youtu.be/baLFl_4ZwXw</a></li>
            <li><i>State-of-the art in nested sampling and MCMC: literature review</i>:</br>
              <a href="https://youtu.be/HFaqcB_H6MA" target="_blank">https://youtu.be/HFaqcB_H6MA</a></li>
          </ol>
          </li>
          <li> BXA Tutorial at <a href="https://cxc.harvard.edu/cdo/cds2021/schedule.html" target="_blank">Chandra Data Science 2021</a> by Peter Boorman & Johannes Buchner:</br>
          <ul>
          <li><a href="https://youtu.be/c1pMDhKFAWA" target="_blank">https://youtu.be/c1pMDhKFAWA</a></li>
          </ul>
          </li>
          <li>Interactive visualisation of the nested sampling algorithm in UltraNest:<br>
            <a href="https://johannesbuchner.github.io/UltraNest/method.html?highlight=demo#visualisation" target="_blank">https://johannesbuchner.github.io/UltraNest/method.html?highlight=demo#visualisation</a>
          </li>
          </ul>

          
        <h4>Scripts</h4>
          <ul>
          <li>Sherpa script for fitting obscured AGN with BXA:<br/><a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/master/examples/sherpa/xagnfitter.py">https://github.com/JohannesBuchner/BXA/blob/master/examples/sherpa/xagnfitter.py</a>
          </li>
          <li>PosteriorStacker (for deriving sample distributions from individual source posterior distributions)<br><a target="_blank" href="https://github.com/JohannesBuchner/PosteriorStacker">https://github.com/JohannesBuchner/PosteriorStacker</a>
          </li>
          <li>example_advanced_priors.py (shows how to include custom priors in BXA)<br><a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/master/examples/xspec/example_advanced_priors.py">https://github.com/JohannesBuchner/BXA/blob/master/examples/xspec/example_advanced_priors.py</a>
          </li>
        </ul>

          <h4>Citations</h4>
          <ul>
          <li>Xspec (& PyXspec) citation - Arnaud et al., (1996; ASPC):<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/1996ASPC..101...17A/abstract">https://ui.adsabs.harvard.edu/abs/1996ASPC..101...17A/abstract</a>
          </li>
          <li>Sherpa citation - Freeman et al., (2001; SPIE):<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2001SPIE.4477...76F/abstract">https://ui.adsabs.harvard.edu/abs/2001SPIE.4477...76F/abstract</a></br>
          In CIAO 4.13, you can use this command to get information on the latest release:</br>
          <code>sherpa> sherpa.citation('latest')</code>&nbsp; <button class="cpbt" onclick="cx('sherpa.citation(\'latest\')')"><i class="icofont-copy"></i></button>
          </li>
          <li>BXA citation - Buchner et al., (2014; A&A)<br><a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2014A%26A...564A.125B/abstract">https://ui.adsabs.harvard.edu/abs/2014A%26A...564A.125B/abstract</a>
          </li>
          <li>UltraNest citation - Buchner (2021, JOSS)<br><a target="_blank" href="https://arxiv.org/abs/2101.09604">https://arxiv.org/abs/2101.09604</a>
          </li>
          </ul>
          
          
          <li><b>Do you know of any others?</b> Please <a href="#contact">get in touch</a>!
          </li>
        </div>
</section>


<section id="session0" class="services">
      <div class="container">
        <div class="section-title">
          <h2><i class="bx bx-terminal"></i> Session 0 - X-ray spectral fitting <a class="headerlink" href="#session0" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
          <p>Key objectives:</p>
          <ul>
            <li>Load a spectrum and fit a model to it in Xspec, PyXspec and/or Sherpa</li>
            <li>Explore a parameter space and test the goodness-of-fit</li>
            <li>Get to grips with plotting in Xspec, PyXspec and Sherpa</li>
          </ul>
        </div>

          If you don't have your own, download the following Chandra/ACIS spectral files from <a href="bxa/s1_chandra.zip" download>here</a>:
        <ul>
          <li>Source spectrum (binned with <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/lheasoft/help/ftgrouppha.html">ftgrouppha</a> grouptype=bmin groupscale=1</code>): <code>sim_chan_bmin.pi</code></li>
          <li>Response: <code>chan.rmf</code></li>
          <li>Effective area: <code>chan.arf</code></li>
          <li>Background spectrum: <code>sim_chan_bkg.pi</code></li>
        </ul>
      </br>

          <h3>Getting started</h3>
          Here are some initial steps to set up a fit for BXA in PyXspec or Sherpa:
        <ul>
          <li>For interactive mode:
            <ul>
            <li>Xspec:
              <br>
              <code>$ xspec</code>&nbsp; <button class="cpbt" onclick="cx('xspec')"><i class="icofont-copy"></i></button>
            </li>
            <li>PyXspec:
              <br>
              <code><pre>
$ ipython
from xspec import *
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('ipython\nfrom xspec import *')"><i class="icofont-copy"></i></button>
</li>
            <li>Sherpa:
              <br>
              <code>$ sherpa</code>&nbsp; <button class="cpbt" onclick="cx('sherpa')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li></br>

          <li>For scripting:
            <ul>
            <li>Xspec:
              <br>
              <code>$ xspec - xspec_script.tcl</code></br>
            Remember to include <code>exit</code> or <code>quit</code> at the end of the script!</li>
            <li>PyXspec:
              <br>
              <code>$ python3 pyxspec_script.py</code></li>
            <li>Sherpa:
              <br>
              <code>$ sherpa sherpa_script.py</code></li>
          </ul>
          </li>

        </ul>
        </div>
</section>





<section id="ex01" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 0.1 - fit a model to data <a class="headerlink" href="#ex01" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
        </div>

        Before starting, the following commands are required:
        <ul>
          <li>Set the fit statistic (here we use modified C-statistics):
            <ul>
          <li>Xspec:
            <br>
            <code>set stat cstat</code>&nbsp; <button class="cpbt" onclick="cx('set stat cstat')"><i class="icofont-copy"></i></button>
          </li>
          <li>PyXspec:
            <br>
            <code>Fit.<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fitmanager.html#statMethod">statMethod</a> = "cstat"</code>
            &nbsp; <button class="cpbt" onclick="cx('Fit.statMethod(&quot;cstat&quot;')"><i class="icofont-copy"></i></button>
          </li>
          <li>Sherpa:
            <br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_stat.html">set_stat</a>("wstat")</code>
            &nbsp; <button class="cpbt" onclick="cx('set_stat(&quot;wstat&quot;')"><i class="icofont-copy"></i></button>
          </li>
        </ul>
          </li></br>

          <li>Set the x-axis units (e.g., instrument channels or energy):
            <ul>
            <li>Xspec:
              <br>
              <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node113.html#setplotenergy">setplot energy</a></code>&nbsp; <button class="cpbt" onclick="cx('setplot energy')"><i class="icofont-copy"></i></button></li>
          <li>PyXspec:
            <br>
            <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/plotmanager.html">Plot.xAxis</a> = "keV"# or "channel"</code>&nbsp; <button class="cpbt" onclick="cx('Plot.xAxis = &quot;keV&quot;')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:
            <br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_analysis.html">set_analysis</a>("ener")# or "chan"</code>&nbsp; <button class="cpbt" onclick="cx('set_analysis(&quot;ener&quot;)')"><i class="icofont-copy"></i></button></li>
        </ul>
          </li></br>

          <li>Plot device (Xspec & PyXspec only):
          <ul>
            <li>Xspec:</br>
            <ul>
              <li>Set the plot device: <code><a href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node109.html" target="_blank">cpd</a> /xw</code>&nbsp; <button class="cpbt" onclick="cx('cpd /xw')"><i class="icofont-copy"></i></button></li>
            </ul>
          </li>
          <li>PyXspec:</br>
              <ul>
            <li>No plot device (useful to avoid plot window pop-ups): <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/plotmanager.html">Plot.device</a> = "/null"</code>&nbsp; <button class="cpbt" onclick="cx('Plot.device = &quot;null&quot;')"><i class="icofont-copy"></i></button></li>
            <li>Set the plot device: <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/plotmanager.html">Plot.device</a> = "/xw"</code>&nbsp; <button class="cpbt" onclick="cx('Plot.device = &quot;/xw&quot;')"><i class="icofont-copy"></i></button></li>
          </ul>
          </ul>
          (other plot devices are available, see <a href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node109.html" target="_blank">here</a>)
          </li><br>
        </ul>

        Next, we load in the data and ignore ineffective energies:
        <ul>
          <li>Load spectra:
          <ul>
            <li>Xspec:</br>
              <code>data 1:1 sim_chan_bmin1.pi</code>&nbsp; <button class="cpbt" onclick="cx('data 1:1 sim_chan_bmin1.pi')"><i class="icofont-copy"></i></button></br>
            </li>
          <li>PyXspec:</br>
              <code>s = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/spectrum.html">Spectrum</a>("sim_chan_bmin1.pi")</code>&nbsp; <button class="cpbt" onclick="cx('s = Spectrum(&quot;sim_chan_bmin1.pi&quot;)')"><i class="icofont-copy"></i></button></br>
              Or:</br>
              <code>s = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html#datamanager-label">AllData</a>("1:1 sim_chan_bmin1.pi")</code>&nbsp; <button class="cpbt" onclick="cx('s = AllData(&quot;1:1 sim_chan_bmin1.pi&quot;)')"><i class="icofont-copy"></i></button>
            </li>
          <li>Sherpa:</br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/load_pha.html">load_pha</a>(1, "sim_chan_bmin1.pi")</code>&nbsp; <button class="cpbt" onclick="cx('load_pha(1, &quot;sim_chan_bmin1.pi&quot;)')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li></br>

          <li>Ignore ineffective energies:
            <ul>
          <li>Xspec:</br>
            <code>ignore 1:0.-0.5 8.-**</code>&nbsp; <button class="cpbt" onclick="cx('ignore 1:0.-0.5 8.-**')"><i class="icofont-copy"></i></button></br>
          </li>
          <li>PyXspec:</br>
            <code>s.<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html">ignore</a>("0.-0.5 8.-**")</code>&nbsp; <button class="cpbt" onclick="cx('s.ignore(&quot;0.-0.5 8.-**&quot;)')"><i class="icofont-copy"></i></button></br>
            Or:</br>
            <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html#datamanager-label">AllData</a>.ignore("1:0.-0.5 8.-**")</code>&nbsp; <button class="cpbt" onclick="cx('AllData.ignore(&quot;0.-0.5 8.-**&quot;)')"><i class="icofont-copy"></i></button>
          </li>
          <li>Sherpa:</br>
          <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/ignore_id.html">ignore_id</a>(1, "0.:0.5,8.:")</code>&nbsp; <button class="cpbt" onclick="cx('ignore_id(1, &quot;0.:0.5,8.:&quot;)')"><i class="icofont-copy"></i></button></li>
          </ul>
        </li></br>
      </ul>

      Then we create a simple <code>powerlaw</code> model and set the model parameter values:
      <ul>
          <li>Create the model:
            <ul>
          <li>Xspec:</br>
          <code>model powerlaw</code>&nbsp; <button class="cpbt" onclick="cx('model powerlaw')"><i class="icofont-copy"></i></button>
        </li>
          <li>PyXspec:</br>
          <code>mymod = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">Model</a>("<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a>")</code>&nbsp; <button class="cpbt" onclick="cx('mymod=Model(&quot;powerlaw&quot;)')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:</br>
            <code><pre id="sherpa_create_model">
mymod = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xspowerlaw.html">xspowerlaw</a>.mypow
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_source.html">set_source</a>(1, mymod)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('mymod = xspowerlaw.mypow\nset_source(1, mymod)')"><i class="icofont-copy"></i></button></br>
          Note <code>xs</code> is used to indicate Xspec models, and <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/get_default_id.html">get_default_id()</a></code> can be used to show the id that is used if an id is not specified</li>
          </ul>
          </li></br>

          <li>Set the parameter values:
          </br>
            Note the <code>min</code>, <code>max</code> parameter bounds are used in the BXA priors and should be set to reasonable values.</br>
          <ul>
          <li>Xspec:</br>
          <code><pre id="xspec_set_par_values">
newpar 1 1.9, 0.1, -1., -1., 4., 4.
newpar 2 1.e-3, 0.1, 1.e-8, 1.e-8, 1., 1.
</pre></code>&nbsp; <button class="cpbt" onclick="cp('xspec_set_par_values')"><i class="icofont-copy"></i></button>
</li>
          <li>PyXspec:</br>
          <code><pre id="pyxspec_set_par_values">
mymod.powerlaw.PhoIndex.values = (1.9, 0.1, -1., -1., 4., 4.)
mymod.powerlaw.norm.values = (1.e-3, 0.1, 1.e-8, 1.e-8, 1., 1.)
</pre></code>&nbsp; <button class="cpbt" onclick="cp('pyxspec_set_par_values')"><i class="icofont-copy"></i></button>
</li>
          Or:</br>
          <code><pre>
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">AllModels</a>(1)(1).values = 1.9, 0.1, -1., -1., 4., 4.
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">AllModels</a>(1)(2).values = 1.e-3, 0.1, 1.e-8, 1.e-8, 1., 1.
</pre></code>&nbsp; <button class="cpbt" onclick="cx('AllModels(1)(1).values = 1.9, 0.1, -1., -1., 4., 4.\nAllModels(1)(2).values = 1.e-3, 0.1, 1.e-8, 1.e-8, 1., 1.')"><i class="icofont-copy"></i></button></li>          
          <li>Sherpa:</br>
            <code><pre>
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(mypow.phoindex, val=1.9, min=-1., max=4.)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(mypow.norm, val=1.e-3, min=1.e-8, max=1.)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('set_par(mypow.phoindex, val=1.9, min=-1., max=4.)\nset_par(mypow.norm, val=1.e-3, min=1.e-8, max=1.)')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li>
        </ul>


        Then all that remains is to fit the model to the data
        <ul>
        </ul>
        </div>
</section>















<section id="session1" class="services">
      <div class="container">
        <div class="section-title">
          <h2><i class="bx bx-terminal"></i> Session 1 - getting started with BXA <a class="headerlink" href="#session1" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
          <p>Key objectives:</p>
          <ul>
          <li>Fit a spectrum with BXA in Sherpa and/or PyXspec</li>
          <li>Use Bayes factors to perform model comparison</li>
          <li>Visualise the confidence ranges on each parameter</li>
          </ul>
        </div>

          If you don't have your own, download the following Chandra/ACIS spectral files from <a href="bxa/s1_chandra.zip" download>here</a>.</br>
          The compressed folder contains:
        <ul>
          <li>Source spectrum (binned with <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/lheasoft/help/ftgrouppha.html">ftgrouppha</a> grouptype=bmin groupscale=1</code>): <code>sim_chan_bmin1.pi</code></li>
          <li>Response: <code>chan.rmf</code></li>
          <li>Effective area: <code>chan.arf</code></li>
          <li>Background spectrum: <code>sim_chan_bkg.pi</code></li>
        </ul>
      </br>

          <h3>Getting started</h3>
          Here are some initial steps to set up a fit for BXA in PyXspec or Sherpa:
        <ul>
          <li>For interactive mode (useful for debugging scripts):
            <ul>
            <li>PyXspec:
              <br>
              <code><pre>
$ ipython
from xspec import *
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('ipython\nfrom xspec import *')"><i class="icofont-copy"></i></button>
</li>
          <li>Sherpa:
            <br>
            <code>$ sherpa</code>&nbsp; <button class="cpbt" onclick="cx('sherpa')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li></br>

          <li>For scripting:
            <ul>
            <li>PyXspec: <code>$ python3 pyxspec_script.py</code>&nbsp; <button class="cpbt" onclick="cx('python3 pyxspec_script.py')"><i class="icofont-copy"></i></button></li>
            <li>Sherpa: <code>$ sherpa sherpa_script.py</code>&nbsp; <button class="cpbt" onclick="cx('sherpa sherpa_script.py')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li></br>

          <li>Setup required packages:
            <ul>
              <li>PyXspec:</br>
          <code><pre id="import_xspec">
from xspec import *
import bxa.xspec as bxa
</pre></code>&nbsp; <button class="cpbt" onclick="cp('import_xspec')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
          <code>import bxa.sherpa as bxa</code>&nbsp; <button class="cpbt" onclick="cx('import bxa.sherpa as bxa')"><i class="icofont-copy"></i></button>
        </li>
      </ul>
          </li></br>

          <li>Set the statistic (here we use modified C-statistics):
            <ul>
          <li>PyXspec:
            <br>
            <code>Fit.<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fitmanager.html#statMethod">statMethod</a> = "cstat"</code>&nbsp; <button class="cpbt" onclick="cx('Fit.statMethod = &quot;cstat&quot;')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:
            <br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_stat.html">set_stat</a>("wstat")</code>&nbsp; <button class="cpbt" onclick="cx('set_stat(&quot;wstat&quot;)')"><i class="icofont-copy"></i></button></li>
        </ul>
          </li></br>

          <li>Set the x-axis units (e.g., instrument channels or energy):
            <ul>
            <li>PyXspec:
              <br>
              <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/plotmanager.html">Plot.xAxis</a> = "keV"# or "channel"</code>&nbsp; <button class="cpbt" onclick="cx('Plot.xAxis = &quot;keV&quot;')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:
            <br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_analysis.html">set_analysis</a>("ener")# or "chan"</code>&nbsp; <button class="cpbt" onclick="cx('set_analysis(&quot;ener&quot;)')"><i class="icofont-copy"></i></button></li>
        </ul>
          </li></br>

          <li>Plot device (PyXspec only):
          <ul>
            <li>No plot device (useful to avoid plot window pop-ups): <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/plotmanager.html">Plot.device</a> = "/null"</code>&nbsp; <button class="cpbt" onclick="cx('Plot.device = &quot;null&quot;')"><i class="icofont-copy"></i></button></li>
            <li>Set the plot device: <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/plotmanager.html">Plot.device</a> = "/xw"</code>&nbsp; <button class="cpbt" onclick="cx('Plot.device = &quot;/xw&quot;')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li></br>

          <li>Load spectra:
          <ul>
            <li>PyXspec:</br>
              <code>s = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/spectrum.html">Spectrum</a>("sim_chan_bmin1.pi")</code>&nbsp; <button class="cpbt" onclick="cx('s = Spectrum(&quot;sim_chan_bmin1.pi&quot;)')"><i class="icofont-copy"></i></button></br>
              Or:</br>
              <code>s = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html#datamanager-label">AllData</a>("1:1 sim_chan_bmin1.pi")</code>&nbsp; <button class="cpbt" onclick="cx('s = AllData(&quot;1:1 sim_chan_bmin1.pi&quot;)')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:</br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/load_pha.html">load_pha</a>(1, "sim_chan_bmin1.pi")</code>&nbsp; <button class="cpbt" onclick="cx('load_pha(1, &quot;sim_chan_bmin1.pi&quot;)')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li></br>

          <li>Ignore ineffective energies:
            <ul>
          <li>PyXspec:</br>
            <code>s.<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html">ignore</a>("0.-0.5 8.-**")</code>&nbsp; <button class="cpbt" onclick="cx('s.ignore(&quot;0.-0.5 8.-**&quot;)')"><i class="icofont-copy"></i></button></br>
            Or:</br>
            <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html#datamanager-label">AllData</a>.ignore("1:0.-0.5 8.-**")</code>&nbsp; <button class="cpbt" onclick="cx('AllData.ignore(&quot;0.-0.5 8.-**&quot;)')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:</br>
          <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/ignore_id.html">ignore_id</a>(1, "0.:0.5,8.:")</code>&nbsp; <button class="cpbt" onclick="cx('ignore_id(1, &quot;0.:0.5,8.:&quot;)')"><i class="icofont-copy"></i></button></li>
          </ul>
        </li></br>

          <li>Create a model:
            <ul>
          <li>PyXspec:</br>
          <code>mymod = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">Model</a>("<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a>")</code>&nbsp; <button class="cpbt" onclick="cx('mymod=Model(&quot;powerlaw&quot;)')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:</br>
            <code><pre id="sherpa_create_model">
mymod = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xspowerlaw.html">xspowerlaw</a>.mypow
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_source.html">set_source</a>(1, mymod)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('mymod = xspowerlaw.mypow\nset_source(1, mymod)')"><i class="icofont-copy"></i></button></br>
          Note <code>xs</code> is used to indicate Xspec models, and <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/get_default_id.html">get_default_id()</a></code> can be used to show the id that is used if an id is not specified</li>
          </ul>
          </li></br>

          <li>Set the parameter values.</br>
            Note the <code>min</code>, <code>max</code> parameter bounds are used in the BXA priors and should be set to reasonable values.</br>
          <ul>
          <li>PyXspec:</br>
          <code><pre id="pyxspec_set_par_values">
mymod.powerlaw.PhoIndex.values = (1.9, 0.1, -1., -1., 4., 4.)
mymod.powerlaw.norm.values = (1.e-3, 0.1, 1.e-8, 1.e-8, 1., 1.)
</pre></code>&nbsp; <button class="cpbt" onclick="cp('pyxspec_set_par_values')"><i class="icofont-copy"></i></button></li>
          Or:</br>
          <code><pre>
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">AllModels</a>(1)(1).values = 1.9, 0.1, -1., -1., 4., 4.
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">AllModels</a>(1)(2).values = 1.e-3, 0.1, 1.e-8, 1.e-8, 1., 1.
</pre></code>&nbsp; <button class="cpbt" onclick="cx('AllModels(1)(1).values = 1.9, 0.1, -1., -1., 4., 4.\nAllModels(1)(2).values = 1.e-3, 0.1, 1.e-8, 1.e-8, 1., 1.')"><i class="icofont-copy"></i></button></li>          
          <li>Sherpa:</br>
            <code><pre>
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(mypow.phoindex, val=1.9, min=-1., max=4.)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(mypow.norm, val=1.e-3, min=1.e-8, max=1.)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('set_par(mypow.phoindex, val=1.9, min=-1., max=4.)\nset_par(mypow.norm, val=1.e-3, min=1.e-8, max=1.)')"><i class="icofont-copy"></i></button></li>
          </ul>
          </li>

        </ul>
        </div>
</section>

<section id="ex11" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 1.1 - prior predictive checks <a class="headerlink" href="#ex11" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
          <em>Prior predictive checks are useful to see if the priors chosen can lead to realistic model realisations.</em>
        </div>

          Note for these exercises, setting priors in BXA is done with the following commands:</br>
          <ul>
            <li>PyXspec:</br>
              <code><pre>
bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_uniform_prior_for">create_uniform_prior_for</a>(model, param)
bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_loguniform_prior_for">create_loguniform_prior_for</a>(model, param)
bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_gaussian_prior_for">create_gaussian_prior_for</a>(model, param, mean, std)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('bxa.create_uniform_prior_for(model, param)\nbxa.create_loguniform_prior_for(model, param)\nbxa.create_gaussian_prior_for(model, param, mean, std)')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code><pre>
bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/priors.html#create_uniform_prior_for">create_uniform_prior_for</a>(param)
bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/priors.html#create_loguniform_prior_for">create_loguniform_prior_for</a>(param)
bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/priors.html#create_gaussian_prior_for">create_gaussian_prior_for</a>(param, mean, std)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('bxa.create_uniform_prior_for(param)\nbxa.create_loguniform_prior_for(param)\nbxa.create_gaussian_prior_for(param, mean, std)')"><i class="icofont-copy"></i></button>          </li>
        
          </ul>
        Note: log uniform priors <strong>cannot be zero or negative</strong>. Make sure the parameter ranges you supply are positive.</br></br>

        To start these exercises, load the data, notice the correct energies and create a powerlaw model (see the commands listed above for help). Then:
        <ul>
          <li>Set the parameter priors for the <a href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node212.html" target="_blank"><code>powerlaw</code></a> model (note <code>norm</code> varies over many orders of magnitude, and <code>PhoIndex</code> can be assumed to have some value within 1.9 &plusmn; 0.15):
          <ul>
          <li>PyXspec:</br>
            <code><pre>
prior1 = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_gaussian_prior_for">create_gaussian_prior_for</a>(mymod, mymod.powerlaw.PhoIndex, 1.9, 0.15)
prior2 = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_loguniform_prior_for">create_loguniform_prior_for</a>(mymod, mymod.powerlaw.norm)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('bxa.create_gaussian_prior_for(mymod, mymod.powerlaw.PhoIndex, 1.9, 0.15)\nbxa.create_loguniform_prior_for(mymod, mymod.powerlaw.norm)')"><i class="icofont-copy"></i></button></li>
          <li>Sherpa:</br>
            <code><pre>
prior1 = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_gaussian_prior_for">create_gaussian_prior_for</a>(mymod.PhoIndex, 1.9, 0.15)
prior2 = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_loguniform_prior_for">create_loguniform_prior_for</a>(mymod.norm)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('bxa.create_gaussian_prior_for(mymod, mymod.powerlaw.PhoIndex, 1.9, 0.15)\nbxa.create_loguniform_prior_for(mymod, mymod.powerlaw.norm)')"><i class="icofont-copy"></i></button></li>
          </ul></br>

          <li>A note on log parameters (Sherpa only):
          Using a loguniform prior may not give the posterior values of that parameter in log units in Sherpa.</br>
          Instead, the <code><a target="_blank" href="https://sherpa.readthedocs.io/en/latest/model_classes/api/sherpa.models.parameter.Parameter.html#sherpa.models.parameter.Parameter">Parameter</a></code> module can convert a parameter to log units, and then one can use a uniform prior for that parameter. E.g.:</br>
<code><pre>from sherpa.models.parameter import <a target="_blank" href="https://sherpa.readthedocs.io/en/latest/model_classes/api/sherpa.models.parameter.Parameter.html#sherpa.models.parameter.Parameter">Parameter</a>
logpar = <a target="_blank" href="https://sherpa.readthedocs.io/en/latest/model_classes/api/sherpa.models.parameter.Parameter.html#sherpa.models.parameter.Parameter">Parameter</a>(modelname, parname, value, min, max, hard_min, hard_max)
mymod.norm = 10**logpar
</pre></code>&nbsp; <button class="cpbt" onclick="cx('from sherpa.models.parameter import Parameter\nlogpar = Parameter(modelname, parname, value, min, max, hard_min, hard_max)\nmymod.norm = 10**logpar')"><i class="icofont-copy"></i></button>
</li>
          Note the parameter will only be valid for working in BXA. If you want to define a log parameter and use this with a standard Sherpa fit, the log parameter must appear in the model expression.</li></br>
          
          <li>Create a solver:
            <ul>
          <li>PyXspec:</br>
            <code>solver = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/solver.html#BXASolver">BXASolver</a>(transformations=[prior1, prior2], outputfiles_basename="powerlaw_pyxspec")</code>
          &nbsp; <button class="cpbt" onclick="cx('bxa.BXASolver(transformations=[prior1, prior2], outputfiles_basename=&quot;powerlaw_pyxspec&quot;)')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code><pre>
solver = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/sherpa-analysis.html#bxa.sherpa.solver.BXASolver">BXASolver</a>(prior=bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/priors.html#create_prior_function">create_prior_function</a>([prior1, prior2]),
                       parameters=[param1, param2],
                       outputfiles_basename="powerlaw_sherpa")
</pre></code>&nbsp; <button class="cpbt" onclick="cx('bxa.BXASolver(prior=bxa.create_prior_function([prior1, prior2]), parameters=[param1, param2], outputfiles_basename=&quot;powerlaw_sherpa&quot;)')"><i class="icofont-copy"></i></button>
</li>
        </ul>
      Make sure <code>outputfiles_basename</code> is unique if running PyXspec and Sherpa in the same directory!
    </li></br>

          <li>Perform prior predictive checks:
            <ol>
          <li>Generate random samples of prior parameter values (remember to <code>import numpy</code>!):
          <ul>
          <li>PyXspec:</br>
            <code>values = solver.prior_function(numpy.random.uniform(size=len(solver.paramnames)))</code>
          &nbsp; <button class="cpbt" onclick="cx('values = solver.prior_function(numpy.random.uniform(size=len(solver.paramnames)))')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code>values = solver.prior_transform(numpy.random.uniform(size=len(solver.paramnames)))</code>
          &nbsp; <button class="cpbt" onclick="cx('values = solver.prior_transform(numpy.random.uniform(size=len(solver.paramnames)))')"><i class="icofont-copy"></i></button>
        </li>
          </ul>
          </li>

          <li>Set the parameters to these values:
          <ul>
          <li>PyXspec:</br>
          <code><pre>
from bxa.xspec.solver import <a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/solver.html#set_parameters">set_parameters</a>
<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/solver.html#set_parameters">set_parameters</a>(transformations=solver.transformations,values=values)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('from bxa.xspec.solver import set_parameters\nset_parameters(transformations=solver.transformations,values=values)')"><i class="icofont-copy"></i></button>
</li>
          <li>Sherpa:</br>
          <code>for i, p in enumerate(solver.parameters): p.val = values[i]</code>
        &nbsp; <button class="cpbt" onclick="cx('for i, p in enumerate(solver.parameters): p.val = values[i]')"><i class="icofont-copy"></i></button>
      </li>
          </ul>
          </li>

          <li>Plot the resulting prior model samples (with the data to help guide the eye):
            <ul>
          <li>PyXspec:</br>
            <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/plotmanager.html">Plot</a>("ldata")</code>
          &nbsp; <button class="cpbt" onclick="cx('Plot(&quot;ldata&quot;)')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/plot_fit.html">plot_fit</a>(xlog=True, ylog=True)</code>
          &nbsp; <button class="cpbt" onclick="cx('plot_fit(xlog=True, ylog=True)')"><i class="icofont-copy"></i></button>
        </li>
        </ul>
          </li>

          </ol>
          </li>

          <div class="col-lg-16">
            <img src="bxa//prior_checks.png" class="img-fluid" alt="">
          </div>
          <li>Produce 10 realisations of the model priors. Are the model ranges covered by the priors physically-acceptable?</li>
          </ul>
        </div>
</section>

<section id="ex12" class="services">
      <div class="container">
        <div class="section-title">
          <!-- <ul> -->
            <h3><i class="bx bx-chevron-right"></i> Exercise 1.2 - fit a model to a spectrum <a class="headerlink" href="#ex12" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
          </div>
        Now that we have checked the priors look reasonable for the data we want to fit, we can fit the model to the data with BXA.
        <ul>
          <li>First fit the model using Levenberg-Marquadt included in Xspec &amp; Sherpa:
            <ul>
              <li>PyXspec:</br>
                <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fitmanager.html">Fit</a>.perform()</code>
              &nbsp; <button class="cpbt" onclick="cx('Fit.perform()')"><i class="icofont-copy"></i></button>
            </li>
          <li>Sherpa:</br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/fit.html">fit</a>()</code>
            &nbsp; <button class="cpbt" onclick="cx('fit()')"><i class="icofont-copy"></i></button>
        </li>
          </ul>
        </li></br>

          <li>Is the fit good? How can you tell? What does changing the parameters by a small amount do?</li></br>

          <li>Next perform the fit with BXA (note this does not require fitting with Levenberg-Marquadt first):
            <ul>
          <li>PyXspec:</br>
            <code>results = solver.<a target="_blank" href="https://johannesbuchner.github.io/BXA/bxa.xspec.html#bxa.xspec.solver.BXASolver.run">run</a>(resume=True)</code>
          &nbsp; <button class="cpbt" onclick="cx('results = solver.run(resume=True)')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code>results = solver.<a target="_blank" href="https://johannesbuchner.github.io/BXA/bxa.sherpa.html#bxa.sherpa.solver.BXASolver.run">run</a>(resume=True)</code>
            &nbsp; <button class="cpbt" onclick="cx('results = solver.run(resume=True)')"><i class="icofont-copy"></i></button>
        </li>
          </ul>
          (Note the hyperlinks are different).</br>
          <code>results</code> contains the posterior samples (<code>results["samples"]</code>) for each parameter and the Bayesian evidence (<code>results["logZ"]</code>, <code>results["logZerr"]</code>). These quantities should also be printed to the screen after the fit is completed.</br>
          To understand more about the information <a target="_blank" href="https://johannesbuchner.github.io/UltraNest/readme.html">UltraNest</a> prints to the screen during and after a fit, see <a target="_blank" href="https://johannesbuchner.github.io/UltraNest/performance.html">here</a>.
          </li></br>

          <li>Examine the best-fit values and uncertainties from the posterior samples. This can be done with <code><a target="_blank" href="https://pandas.pydata.org">pandas</a></code> (may require installing with e.g., <code>conda install pandas</code>):</br>
          <code><pre>
import <a target="_blank" href="https://pandas.pydata.org">pandas</a> as pd
df = pd.<a target="_blank" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html">DataFrame</a>(data=results["samples"], columns=solver.paramnames)
df.head()</pre></code>
&nbsp; <button class="cpbt" onclick="cx('import pandas as pd\ndf = pd.DataFrame(data=results[&quot;samples&quot;], columns=solver.paramnames)\ndf.head()')"><i class="icofont-copy"></i></button>
          </li></br>
          <li>How do the best-fits and confidence ranges compare with using nested sampling vs. Levenberg-Marquadt?</li>
          </ul>
          </br>
        </div>
</section>

<section id="ex13" class="services">
      <div class="container">
        <div class="section-title">
            <h3><i class="bx bx-chevron-right"></i> Exercise 1.3 - fit and compare multiple models <a class="headerlink" href="#ex13" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
            <em>Here we use the Bayesian evidence to perform model comparison with Bayes factors.</em>
          </div>
          
          <ul>
          <li>Note to use <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node264.html">TBabs</a></code>, one should set the abundances to those from <a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2000ApJ...542..914W/abstract">Wilms, Allen &amp; McCray (2000)</a>:
          <ul>
          <li>PyXspec:</br>
            <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/xspecsettings.html">Xset.abund</a> = "wilm"</code>
          &nbsp; <button class="cpbt" onclick="cx('Xset.abund = &quot;wilm&quot;')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_xsabund.html">set_xsabund</a>("wilm")</code>
          &nbsp; <button class="cpbt" onclick="cx('set_xsabund(&quot;wilm&quot;)')"><i class="icofont-copy"></i></button>
        </li></br>
          </ul>
        </li>

          <li>Using your previous code, fit the following additional 2 models to the data with BXA (don't forget to give unique <code>outputfiles_basename</code> values!):
            <ol>
          <li>Absorbed powerlaw:</br>
            For <code>nh</code>, you can assume <code>delta = 0.1</code>, <code>min = 1.e-2</code>, <code>bottom = 1.e-2</code>, <code>top = 5.e2</code>, <code>max = 5.e2</code>.</br>
            <ul>
          <li>PyXspec:</br>
            <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node264.html">TBabs</a> * <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a></code>
          &nbsp; <button class="cpbt" onclick="cx('TBabs * powerlaw')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa4.3/ahelp/xstbabs.html">xstbabs</a> * <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xspowerlaw.html">xspowerlaw</a></code>
          &nbsp; <button class="cpbt" onclick="cx('xstbabs * xspowerlaw')"><i class="icofont-copy"></i></button>
        </li>
        </ul></li>
          <li>Absorbed powerlaw + Gaussian emission line (assume the emission line for this source is known to have line centroid energy <code>LineE</code> = 6.3 &plusmn; 0.15 keV, and that the line is narrow with fixed width <code>Sigma</code> = 1 eV):</br>
            <ul>
          <li>PyXspec (note to fix a parameter, you can set <code>delta = -1</code>):</br>
            <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node264.html">TBabs</a> * <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a> + <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node175.html">gaussian</a></code>
          &nbsp; <button class="cpbt" onclick="cx('xstbabs * xspowerlaw + gaussian')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa4.3/ahelp/xstbabs.html">xstbabs</a> * <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xspowerlaw.html">xspowerlaw</a> + <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xsgaussian.html">xsgaussian</a></code>
          &nbsp; <button class="cpbt" onclick="cx('xstbabs * xspowerlaw + xsgaussian')"><i class="icofont-copy"></i></button>
        </li>
        </ul></br>
      </li>
          </ol>
          </li>

          <li>Copy the <a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/master/examples/xspec/model_compare.py">model_compare.py</a> script to your working directory to perform Bayesian evidence model comparison</li></br>

          <li>Run the script:</br>
            <code>$ python3 model_compare.py outputfiles_basename1/ outputfiles_basename2/ outputfiles_basename3/</code>
          &nbsp; <button class="cpbt" onclick="cx('python3 model_compare.py outputfiles_basename1/ outputfiles_basename2/ outputfiles_basename3/')"><i class="icofont-copy"></i></button>
        </li></br>

          <li>Compute the <a target="_blank" href="https://en.wikipedia.org/wiki/Akaike_information_criterion">Akaike Information Criterion (AIC)</a> for each model in python:</br>
          <code><pre>import <a target="_blank" href="https://docs.python.org/3/library/json.html">json</a>
basenames = [outputfiles_basename1, outputfiles_basename2, outputfiles_basename3]
loglikes = <a target="_blank" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>([(f, json.<a target="_blank" href="https://docs.python.org/3/library/json.html#json.load">load</a>(open(f + "/info/results.json"))["maximum_likelihood"]["logl"]) for f in basenames])
dofs = <a target="_blank" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>([(f, len(json.<a target="_blank" href="https://docs.python.org/3/library/json.html#json.load">load</a>(open(f + "/info/results.json"))["paramnames"])) for f in basenames])
aic = <a target="_blank" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>([(basename, (2. * dofs[basename] - 2. * loglike)) for basename, loglike in loglikes.items()])
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('import json\nbasenames = [outputfiles_basename1, outputfiles_basename2, outputfiles_basename3]\nloglikes = dict([(f, json.load(open(f + &quot;/info/results.json&quot;))[&quot;maximum_likelihood&quot;][&quot;logl&quot;]) for f in basenames])\ndofs = dict([(f, len(json.load(open(f + &quot;/info/results.json&quot;))[&quot;paramnames&quot;])) for f in basenames])\naic = dict([(basename, (2. * dofs[basename] - 2. * loglike)) for basename, loglike in loglikes.items()])')"><i class="icofont-copy"></i></button>
          </li></br>

          <li>Which model best explains the data? Why?</li>

          </ul>
          </br>
      </div>
</section>

<section id="ex14" class="services">
      <div class="container">
        <div class="section-title">
            <h3><i class="bx bx-chevron-right"></i> Exercise 1.4 - error propagation <a class="headerlink" href="#ex14" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
            <em>By generating quantities directly from the posterior samples, we propagate the uncertainties and conserve any structure (e.g., degeneracies, multiple modes).</em>
          </div>

          As an example, we will estimate the equivalent width of the emission line used in the Absorbed powerlaw + Gaussian model above.
          <ul>
          <li>The equivalent width (<code>EW</code> below) of an emission line is defined as the flux in the line divided by the flux of the continuum at the line energy (see the <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node95.html">Xspec documentation</a> for more information).</li></br>
          
          <li>For the model we have used, the equivalent width of the emission line relative to the intrinsic (i.e. unabsorbed) powerlaw continuum is (in terms of the parameters defined):
            <ul>
          <li>PyXspec:</br>
            <code><pre>
solver3.set_paramnames(["log(nH)", "mypow.phoindex", "mypow.lognorm", "line.linee", "line.lognorm"])
df = pd.DataFrame(data = results3["samples"], columns = solver3.paramnames)
df.loc[:, "EW"] = (df["line.lognorm"] / df["mypow.lognorm"]) * df["line.linee"] ** df["mypow.phoindex"]
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('solver3.set_paramnames([&quot;log(nH)&quot;, &quot;mypow.phoindex&quot;, &quot;mypow.lognorm&quot;, &quot;line.linee&quot;, &quot;line.lognorm&quot;])\ndf = pd.DataFrame(data = results3[&quot;samples&quot;], columns = solver3.paramnames)\ndf.loc[:, &quot;EW&quot;] = (df[&quot;line.lognorm&quot;] / df[&quot;mypow.lognorm&quot;]) * df[&quot;line.linee&quot;] ** df[&quot;mypow.phoindex&quot;]')"><i class="icofont-copy"></i></button>
        </li>
          <li>Sherpa:</br>
            <code><pre>
df = pd.DataFrame(data = results3["samples"], columns = solver3.paramnames)
df.loc[:, "EW"] = (df["line.norm"] / df["mypow.norm"]) * df["line.linee"] ** df["mypow.phoindex"]
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('df = pd.DataFrame(data = results3[&quot;samples&quot;], columns = solver3.paramnames)\ndf.loc[:, &quot;EW&quot;] = (df[&quot;line.norm&quot;] / df[&quot;mypow.norm&quot;]) * df[&quot;line.linee&quot;] ** df[&quot;mypow.phoindex&quot;]')"><i class="icofont-copy"></i></button>
        </li>
          </ul>
         Generate posterior samples for equivalent width. If using pandas, this will involve creating a new column in the pandas dataframe of posterior samples for the equivalent width.
        </li></br>

          <li>Use the <code>results["samples"]</code> to derive the posterior distribution on equivalent width for the emission line component. If using pandas:</br>
          <code><pre>import <a target="_blank" href="https://corner.readthedocs.io/en/latest/pages/quickstart.html">corner</a>
figure = corner.corner(df, labels = df.columns, quantiles = [0.16, 0.5, 0.84], show_titles = True)</pre></code>
          &nbsp; <button class="cpbt" onclick="cx('import corner\nfigure = corner.corner(df, labels = df.columns, quantiles = [0.16, 0.5, 0.84], show_titles = True)')"><i class="icofont-copy"></i></button>
        </li></br>
          
          <li>Is the equivalent width degenerate with any other parameters? Why or why not?</li>
          </ul>
        </div>
</section>

<section id="ex15" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 1.5 - visualisation <a class="headerlink" href="#ex15" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
        </div>
        We want a simple way to check that our model makes sense, that the fit worked, and to infer information on the source being fit.</br></br>

        <ul>
          <li> First, examine the corner and trace plots that BXA produces (located in <code>outputfiles_basename/plots/</code>). What do these plots show?</li></br>

          <li>Are there any parameter degeneracies? Why or why not?</li></br>

          <li>Create a <a target="_blank" href="https://johannesbuchner.github.io/BXA/xspec-analysis.html#model-discovery">Quantile-Quantile</a> (also <a target="_blank" href="https://en.wikipedia.org/wiki/Q–Q_plot">here</a> for a more general explanation) plot for your fits:
            <ul>
          <li>PyXspec (produces plot):</br>
          <code><pre>import <a target="_blank" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.html">matplotlib.pyplot</a> as plt
print("creating quantile-quantile plot ...")
plt.<a target="_blank" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html">figure</a>(figsize=(7,7))
with bxa.XSilence():
    solver.set_best_fit()
    bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/qq.html">qq.qq</a>(prefix=outputfiles_basename, markers=5, annotate=True)
print("saving plot...")
plt.<a target="_blank" href="https://matplotlib.org/2.2.5/api/_as_gen/matplotlib.pyplot.savefig.html">savefig</a>(outputfiles_basename + "qq_model_deviations.pdf", bbox_inches="tight")
plt.<a target="_blank" href="https://matplotlib.org/2.1.0/api/_as_gen/matplotlib.pyplot.close.html">close</a>()</pre></code>
&nbsp; <button class="cpbt" onclick="cx('import matplotlib.pyplot as plt\nprint(&quot;creating quantile-quantile plot ...&quot;)\nplt.figure(figsize=(7,7))\nwith bxa.XSilence():\n    solver.set_best_fit()\n    bxa.qq.qq(prefix=outputfiles_basename, markers=5, annotate=True)\nprint(&quot;saving plot...&quot;)\nplt.savefig(outputfiles_basename + &quot;qq_model_deviations.pdf&quot;, bbox_inches=&quot;tight&quot;)\nplt.close()')"><i class="icofont-copy"></i></button>
</li>
          <li>Sherpa (produces file that needs to be plotted separately):</br>
          <code><pre>
from bxa.sherpa.qq import qq_export
bxa.qq.<a target="_blank" href="http://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/qq.html#qq_export">qq_export</a>(1, bkg=False, outfile=outputfiles_basename + "_qq", elow=0.2, ehigh=10)</pre></code>
        &nbsp; <button class="cpbt" onclick="cx('from bxa.sherpa.qq import qq_export\nqq_export(1, bkg=False, outfile=outputfiles_basename + &quot;_qq&quot;, elow=0.2, ehigh=10)')"><i class="icofont-copy"></i></button>
      </li>
          </ul>
          </li></br>

          <div class="col-lg-16">
            <img src="bxa//qq_plots.png" class="img-fluid" alt="">
          </div>

          <li>What does the <code>powerlaw</code> model Q-Q plot show? Is this model lacking any components?</li></br>

          <li>(PyXspec only) Produce a plot of posterior model spectra (<a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/13824b292018e8ffaac9024886bc713334fd7051/examples/xspec/example_simplest.py#L36">convolved</a> and <a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/13824b292018e8ffaac9024886bc713334fd7051/examples/xspec/example_simplest.py#L65">unconvolved</a>) using the code in the <a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/master/examples/xspec/example_simplest.py">example_simplest.py</a> script included in BXA. Which energies is the model best-constrained over?</li></br>
          </br>
      </div>
</section>

<section id="ex16" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 1.6 - fitting multiple datasets simultaneously with BXA <a class="headerlink" href="#ex16" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
          <p><em>Sometimes it is advantageous to fit multiple spectra for the same source simultaneously with e.g., a cross-calibration constant to account for instrumental differences in the separate spectra.</em></p>
        </div>
          For this example, we need another dataset. As an example, we will use a NuSTAR/FPMA spectrum which has a bandpass that extends to E &gt; 10 keV. So including this data with our Chandra spectral analysis will extend the energy range we can study our source over to ~78 keV. To download the NuSTAR spectral files:
          <ul>
          <li>Source spectrum (<code>sim_nuA_bmin1.pi</code>) & background spectrum (<code>sim_nuA_bkg.pi</code>) <a href="bxa/ex16_nustar.zip" download>here</a>.</li>
          <li>Response (<code>nustar.rmf</code>) and effective area (<code>point_30arcsecRad_1arcminOA.arf</code>) files from the <a href="https://www.nustar.caltech.edu/system/media_files/binaries/32/original/nustar_point_sources_for_proposers.tgz?1404172745">Point source simulation files</a> (distributed by the NuSTAR team, more info <a target="_blank" href="https://www.nustar.caltech.edu/page/response_files">here</a>).</li>
          </li>
        </ul></br>

        We first assume that the source was not variable between the Chandra and NuSTAR observations, and thus only account for differences arising from the calibration of either instrument.
        <ul>
          <li>First, include a cross-calibration constant in your model between the Chandra and NuSTAR datasets:</br>
          <ul>
          <li>PyXspec:</br>
          <code><pre>
s = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html#datamanager-label">AllData</a>("1:1 sim_nuA_bmin1.pi 2:2 sim_chan_bmin1.pi")
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html#datamanager-label">AllData</a>.ignore("1:0.-3. 78.-** 2:0.-0.5 8.-**")
mymod = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">Model</a>("<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/node235.html">constant</a> * <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a>")
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">AllModels</a>(1)(1).values = (1., -0.01)
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">AllModels</a>(2)(1).values = (1., 0.01, 0.01, 0.01, 10., 10.)</pre></code>
&nbsp; <button class="cpbt" onclick="cx('s = AllData(&quot;1:1 sim_nuA_bmin1.pi 2:2 sim_chan_bmin1.pi&quot;)\nAllData.ignore(&quot;1:0.-3. 78.-** 2:0.-0.5 8.-**&quot;)\nmymod = Model(&quot;constant * powerlaw&quot;)\nAllModels(1)(1).values = (1., -0.01)\nAllModels(2)(1).values = (1., 0.01, 0.01, 0.01, 10., 10.)')"><i class="icofont-copy"></i></button>
          </li>
          
          <li>Sherpa:</br>
          <code><pre>
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/load_pha.html">load_pha</a>(1, "sim_nuA_bmin1.pi")
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/ignore_id.html">ignore_id</a>(1, "0.:3.,78.:")
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/load_pha.html">load_pha</a>(2, "sim_chan_bmin1.pi")
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/ignore_id.html">ignore_id</a>(2, "0.:0.5,8.:")
mymod = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xspowerlaw.html">xspowerlaw</a>.mypow
mymod1 = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xsconstant.html">xsconstant</a>("xcal1") * mymod
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(xcal1, val=1, frozen=True)
mymod2 = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xsconstant.html">xsconstant</a>("xcal2") * mymod
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(xcal2, val=1, min = 1.e-2, max = 1.e2)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_source.html">set_source</a>(1, mymod1)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_source.html">set_source</a>(2, mymod2)</pre></code>
&nbsp; <button class="cpbt" onclick="cx('load_pha(1, &quot;sim_nuA_bmin1.pi&quot;)\nignore_id(1, &quot;0.:3.,78.:&quot;)\nload_pha(2, &quot;sim_chan_bmin1.pi&quot;)\nignore_id(2, &quot;0.:0.5,8.:&quot;)\nmymod = xspowerlaw.mypow\nmymod1 = xsconstant(&quot;xcal1&quot;) * mymod\nset_par(xcal1, val=1, frozen=True)\nmymod2 = xsconstant(&quot;xcal2&quot;) * mymod\nset_par(xcal2, val=1, min = 1.e-2, max = 1.e2)\nset_source(1, mymod1)\nset_source(2, mymod2)')"><i class="icofont-copy"></i></button>
          <!-- <code>Parameter_kwargs = {"modelname": 'crosscal', "name": "logC2", "val": np.log10(xcal2), "min": -2., "max": 2.}
          <code>logXcal2 = Parameter(**Parameter_kwargs)
          <code>set_par(crossCalID.factor, val = 10 ** logXcal2) -->
          </li>
        </ul></li></br>
          <li>Fit the new model with BXA and derive a posterior confidence range on the cross-calibration constant:</br>
          <ul>
          <li>PyXspec:</br>
          <code><pre>
transformations.append(bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_loguniform_prior_for">create_loguniform_prior_for</a>(AllModels(2), AllModels(2).constant.factor))
solver = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/solver.html#BXASolver">BXASolver</a>(transformations=transformations, outputfiles_basename="xcal_pl_pyxspec")
results = solver.<a target="_blank" href="https://johannesbuchner.github.io/BXA/bxa.xspec.html#bxa.xspec.solver.BXASolver.run">run</a>(resume=True)</pre></code>
&nbsp; <button class="cpbt" onclick="cx('transformations.append(bxa.create_loguniform_prior_for(AllModels(2), AllModels(2).constant.factor))\nsolver = bxa.BXASolver(transformations=transformations, outputfiles_basename=&quot;xcal_pl_pyxspec&quot;)\nresults = solver.run(resume=True)')"><i class="icofont-copy"></i></button>        </li>
          <li>Sherpa:</br>
          <code><pre>
priors.append(bxa.create_loguniform_prior_for(xcal2))
parameters.append(xcal2)
solver = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/sherpa-analysis.html#bxa.sherpa.solver.BXASolver">BXASolver</a>(prior=bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/priors.html#create_prior_function">create_prior_function</a>([prior1, prior2, ...]), parameters=[param1, param2, ...], outputfiles_basename="xcal_pl_sherpa")
results = solver.<a target="_blank" href="https://johannesbuchner.github.io/BXA/bxa.sherpa.html#bxa.sherpa.solver.BXASolver.run">run</a>(resume=True)</pre></code>
&nbsp; <button class="cpbt" onclick="cx('priors.append(bxa.create_loguniform_prior_for(xcal2))\nparameters.append(xcal2)\nsolver = bxa.BXASolver(prior=bxa.create_prior_function([prior1, prior2, ...]), parameters=[param1, param2, ...], outputfiles_basename=&quot;xcal_pl_sherpa&quot;)\nresults = solver.run(resume=True)')"><i class="icofont-copy"></i></button>
          </li>
        </ul></li></br>

          <li>How have the confidence ranges on all the parameters changed after including NuSTAR?</li></br>

          <li>How have the Bayes factors between different model fits changed? Why?</li></br>
          </ul>
        </div>
</section>

<section id="ex17" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 1.7 - (Sherpa only) automated background fitting with BXA <a class="headerlink" href="#ex17" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
        </div>

        So far, the exercises have used modified C-statistics (aka W-statistics) in which the background is modelled as a stepwise function with the same number of parameters as bins. This process typically requires some form of minimal binning (see discussion <a target="_blank" href="https://giacomov.github.io/Bias-in-profile-poisson-likelihood/">here</a>).</br></br>

          Using C-statistics can be more flexible, since no binning is required by simultaneously fitting a background model instead. Here we use the <code><a target="_blank" href="https://johannesbuchner.github.io/BXA/pca-background-models.html">auto_background</a></code> function in BXA, which provides a powerful way to implement background models in Sherpa, and simultaneously fit with a source model using BXA.</br></br>

          <ul>
          <li>Load the data, source model and priors as in Exercise 1.1 (make sure to also change the statistic from <code>wstat</code> to <code>cstat</code>!)</li></br>

          <li>Load the automatic PCA background model (see <a target="_blank" href="https://ui.adsabs.harvard.edu/abs/2018A%26A...618A..66S/abstract">Simmonds et al., 2018</a> for more information):</br>
          <code><pre>
from bxa.sherpa.background.pca import <a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/background/pca.html#auto_background">auto_background</a>
<a target="_blank" href="https://cxc.harvard.edu/sherpa/ahelp/set_model.html">set_model</a>(1, model)
convmodel = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/get_model.html">get_model</a>(1)
bkg_model = <a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/background/pca.html#auto_background">auto_background</a>(1)
<a target="_blank" herf="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_full_model.html">set_full_model</a>(1, convmodel + bkg_model*<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/get_bkg_scale.html">get_bkg_scale</a>(1))
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('from bxa.sherpa.background.pca import auto_background\nset_model(1, model)\nconvmodel = get_model(1)\nbkg_model = auto_background(1)\nset_full_model(1, convmodel + bkg_model*get_bkg_scale(1))')"><i class="icofont-copy"></i></button>
          </li>

          <li>Remember to include the zeroth order component from the PCA background model in the priors and parameters list so that BXA knows to vary it as a free parameter:</br>
          <code><pre>
parameters += [bkg_model.pars[0]]
priors += [bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/priors.html#create_uniform_prior_for">create_uniform_prior_for</a>(bkg_model.pars[0])]
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('parameters += [bkg_model.pars[0]]\npriors += [bxa.create_uniform_prior_for(bkg_model.pars[0])]')"><i class="icofont-copy"></i></button>
          </li></br>

          <li>Fit the source + background model with BXA</li></br>

          <li>Check the background fit (e.g., with <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/plot_bkg_fit.html">get_bkg_fit</a></code>, <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/plot_bkg_fit_ratio.html">get_bkg_fit_ratio</a></code>, <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/plot_bkg_fit_resid.html">get_bkg_fit_resid</a></code>).</li></br>

          <li>Have the uncertainty ranges changed at all for the parameters? Why or why not?</li>
        </ul>
      </div>
</section>

<section id="session2" class="services">
      <div class="container">
        <div class="section-title">
          <h2><i class="bx bx-bar-chart-alt-2"></i> Session 2 - more advanced concepts <a class="headerlink" href="#session2" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
          Key objectives:
          <ul>
          <li>Combine individual posteriors to constrain a population</li>
          <li>Calibrate model selection thresholds with simulations</li>
          <li>Perform model verification to test the Goodness-of-Fit</li>
        </ul>
        </div>

          These exercises involve simulating spectra. To do this, you will need a response file (rmf), an effective area file (arf) and (optionally) a background spectrum file:

          <ul>
          <li>PyXspec (using <code><a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fakeitsettings.html">fakeit</a></code>):</br>
          <code><pre>
mymod = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/model.html">Model</a>("<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a>")
mymod.<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a>.PhoIndex.values = (1.9, 0.01, -3., -3., 3., 3.)
mymod.<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/manual/XSmodelPowerlaw.html">powerlaw</a>.norm.values = (1.e-3, 0.01, 1.e-8, 1.e-8, 1., 1.)
fakeit_kwargs = {}
fakeit_kwargs["response"] = "chan.rmf"
fakeit_kwargs["arf"] = "chan.arf"
fakeit_kwargs["background"] = "chan_bkg.pi"
fakeit_kwargs["exposure"] = 30.e3
fakeit_kwargs["correction"] = "1."
fakeit_kwargs["backExposure"] = 30.e3
fakeit_kwargs["fileName"] = "sim_chan.pi"
<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/datamanager.html#datamanager-label">AllData</a>.<a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fakeitsettings.html">fakeit</a>(1, <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fakeitsettings.html">FakeitSettings</a>(**fakeit_kwargs))
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('mymod = Model(&quot;powerlaw&quot;)\nmymod.powerlaw.PhoIndex.values = (1.9, 0.01, -3., -3., 3., 3.)\nmymod.powerlaw.norm.values = (1.e-3, 0.01, 1.e-8, 1.e-8, 1., 1.)\nfakeit_kwargs = {}\nfakeit_kwargs[&quot;response&quot;] = &quot;chan.rmf&quot;\nfakeit_kwargs[&quot;arf&quot;] = &quot;chan.arf&quot;\nfakeit_kwargs[&quot;background&quot;] = &quot;chan_bkg.pi&quot;\nfakeit_kwargs[&quot;exposure&quot;] = 30.e3\nfakeit_kwargs[&quot;correction&quot;] = &quot;1.&quot;\nfakeit_kwargs[&quot;backExposure&quot;] = 30.e3\nfakeit_kwargs[&quot;fileName&quot;] = &quot;sim_chan.pi&quot;\nAllData.fakeit(1, FakeitSettings(**fakeit_kwargs))')"><i class="icofont-copy"></i></button>
          </li>
          <li>Sherpa (using <code><a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/fake_pha.html">fake_pha</a></code>):</br>
          <code><pre>
mymod = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/xspowerlaw.html">xspowerlaw</a>.mypow
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(mymod.phoindex, val = 1.9, min = -3., max = 3.)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(mymod.norm, val = 1.e-3, min = 1.e-8, max = 1.)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/load_pha.html">load_pha</a>(1, "chan_src.pi") #loading pre-exising source spectrum with rmf, arf & bkg present
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_source.html">set_source</a>(1, mymod)
fakepha_kwargs = {}
fakepha_kwargs["rmf"] = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/get_rmf.html">get_rmf</a>()
fakepha_kwargs["arf"] = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/get_arf.html">get_arf</a>()
fakepha_kwargs["bkg"] = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/get_bkg.html">get_bkg</a>()
fakepha_kwargs["exposure"] = 30.e3
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/fake_pha.html">fake_pha</a>(1, **fakepha_kwargs)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/save_pha.html">save_pha</a>(1, "sim_chan.pi", clobber = True)
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('mymod = xspowerlaw.mypow\nset_par(mymod.phoindex, val = 1.9, min = -3., max = 3.)\nset_par(mymod.norm, val = 1.e-3, min = 1.e-8, max = 1.)\nload_pha(1, &quot;chan_src.pi&quot;) #loading pre-exising source spectrum with rmf, arf & bkg present\nset_source(1, mymod)\nfakepha_kwargs = {}\nfakepha_kwargs[&quot;rmf&quot;] = get_rmf()\nfakepha_kwargs[&quot;arf&quot;] = get_arf()\nfakepha_kwargs[&quot;bkg&quot;] = get_bkg()\nfakepha_kwargs[&quot;exposure&quot;] = 30.e3\nfake_pha(1, **fakepha_kwargs)\nsave_pha(1, &quot;sim_chan.pi&quot;, clobber = True)')"><i class="icofont-copy"></i></button>
          </li>
          </ul>
        </div>
</section>

<section id="ex21" class="services">
      <div class="container">
        <div class="section-title">
            <h3><i class="bx bx-chevron-right"></i> Exercise 2.1 - calibrating model comparison thresholds <a class="headerlink" href="#ex21" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
            <p><em>Here we will estimate the false-positive and false-negative rates associated with selecting models via Bayes factors vs. &Delta;&#8239;AIC for the models and data we are using. This will help us determine a good selection threshold to use in terms of &Delta;&#8239;logZ and &Delta;&#8239;AIC.</em></p>
        </div>
        <ul>
          <li>Simulate 50 Chandra spectra from the <code>absorbed powerlaw + gaussian</code> best-fit model that you found in <a href="#ex13">Exercise 1.3</a>, with the original Chandra spectrum files.</li></br>
          <li>Repeat the previous step, but for a powerlaw normalisation 5x fainter than the best-fit you found.</li></br>
          <li>For each of the 100 spectra you have simulated, fit the <code>powerlaw</code>, <code>absorbed powerlaw</code> and <code>absorbed powerlaw + gaussian</code> models with BXA.</li></br>
          <li>Perform the same Bayes factor and &Delta;&#8239;<a target="_blank" href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a> model selection techniques as in <a href="#ex13">Exercise 1.3</a> to select a favoured model for each of the 100 spectra.</li></br>
          <li>How many times is the correct model that was simulated (<code>absorbed powerlaw + gaussian</code>) selected in the brighter and fainter samples? How many times do the Bayes factors not make a decision (i.e. logZ<sub>1</sub>/Z<sub>2</sub> ~ 0)?</li></br>
          <li>How does the false-positive/negative rate vary with signal-to-noise in the source spectrum?</li></br>
          <li>Use the same process to estimate an appropriate &Delta;&#8239;<a target="_blank" href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a> threshold that will select the correct models.</li></br>
        </ul>
        </div>
</section>

<section id="ex22" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 2.2 - posterior predictive checks <a class="headerlink" href="#ex22" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
          <p><em>Model selection can only tell us how likely a model is relative to another. Here we will estimate the goodness-of-fit and test the ability of a given model to reproduce the nuances in the source spectrum data with Monte Carlo simulations.</em></p>
        </div>
        <ul>
          <li>Load the BXA fit (with e.g., <code>results = solver.<a target="_blank" href="https://johannesbuchner.github.io/BXA/bxa.xspec.html#bxa.xspec.solver.BXASolver.run">run</a>(resume=True)</code> <button class="cpbt" onclick="cx('results = solver.run(resume=True)')"><i class="icofont-copy"></i></button>) for the <code>powerlaw</code> model from <a href="#ex12">Exercise 1.2</a>.</li></br>
          <li>Note the best-fit C-statistic & degrees of freedom (dofs):</br>
          PyXspec:</br>
          <code><pre>
stat = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fitmanager.html">Fit</a>.statistic
dof = <a target="_blank" href="https://heasarc.gsfc.nasa.gov/xanadu/xspec/python/html/fitmanager.html">Fit</a>.dof
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('stat = Fit.statistic\ndof = Fit.dof')"><i class="icofont-copy"></i></button><br>
          Sherpa:</br>
          <code><pre>
statinfo = <a target="_blank" href="https://cxc.harvard.edu/sherpa/ahelp/get_stat_info.html">get_stat_info</a>()
stat = statinfo[1].statval
dof = statinfo[1].dof
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('statinfo = get_stat_info()\nstat = statinfo[1].statval\ndof = statinfo[1].dof')"><i class="icofont-copy"></i></button>
          </li></br>
          <li>Perform many times:
          <ol>
          <li>Simulate the best-fit model (make sure to use the same spectral files and exposure time as the original).</li>
          <li>Without re-fitting*, store the simulated C-statistic & dofs of the simulated data and model.<br>
            * It would be ideal to re-fit, but this can be inefficient and/or lead to incorrect results with a standard fit in PyXspec and/or Sherpa (due to local minima). Note that performing a standard Sherpa fit will require <b>all free parameters, including log parameters, to appear in the model expression</b>.
          </li><br>
          </ol>
          </li>
          <li>Plot the distribution of simulated C-statistic / dof values and compare to the real value. Is the fit acceptable?</li></br>
          <li>Now repeat the process with the <code>absorbed powerlaw + gaussian</code> model. How does the goodness-of-fit for this model compare to the <code>powerlaw</code> model?</li></br>
        </ul>
        </div>
</section>

<section id="ex23" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 2.3 - Bayesian Hierarchical Modelling introduction <a class="headerlink" href="#ex23" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
          <p><em>Here we will combine several individual source posterior distributions to derive a sample distribution for the photon index .</em></p>
        </div>

        <ul>

          <li>Install <a target="_blank" href="https://github.com/JohannesBuchner/PosteriorStacker">PosteriorStacker</a>:<br>
            <code>$ pip install posteriorstacker</code>
            &nbsp; <button class="cpbt" onclick="cx('pip install posteriorstacker')"><i class="icofont-copy"></i></button>
            <br>Alternatively, you can just download the script and use it in your directory.</li></br>
          <li>To generate the posterior samples used in this exercise, download and run the following <a href="./bxa/ex21_pyxspec.py" download>PyXspec</a> (<code>$ python3 ex21_pyxspec.py</code> <button class="cpbt" onclick="cx('python3 ex21_pyxspec.py')"><i class="icofont-copy"></i></button>) or <a href="./bxa/ex21_sherpa.py" download>Sherpa</a> (<code>$ sherpa ex21_sherpa.py</code> <button class="cpbt" onclick="cx('sherpa ex21_sherpa.py')"><i class="icofont-copy"></i></button>) script. The script will generate 30 <a target="_blank" href="https://johannesbuchner.github.io/UltraNest/readme.html">UltraNest</a> output folders by:</br>
          <ol>
          <li>Simulating NuSTAR spectra from an <code>absorbed powerlaw</code> model (see <a href="ex13">Exercise 1.3</a>), with <code>PhoIndex</code> sampled from a Gaussian distribution 1.8 +/- 0.3. Note you will need the <a href="https://www.nustar.caltech.edu/system/media_files/binaries/32/original/nustar_point_sources_for_proposers.tgz?1404172745">Point source simulation files</a> distributed by the NuSTAR team to run the scripts (more info <a target="_blank" href="https://www.nustar.caltech.edu/page/response_files">here</a>).</li>
          <li>Each spectrum will then be fit with BXA using non-informative priors for line-of-sight column density, powerlaw photon index and powerlaw normalisation.</li>
          </ol>
          </li>
          <li>The script may take some time (~ a few hours) to complete. Alternatively, you can download some pre-generated <a target="_blank" href="https://johannesbuchner.github.io/UltraNest/readme.html">UltraNest</a> folders using a similar model <a href="bxa/ex21_ultranest_posteriors.zip">here</a>.</li></br>
          <li>From inside the <code>ultranest_posteriors</code> directory, run:</br>
          <code><pre>
$ <a target="_blank" href="https://github.com/JohannesBuchner/PosteriorStacker/blob/main/load_ultranest_outputs.py">load_ultranest_outputs.py</a> fitsim0/ fitsim1/ fitsim2/ fitsim3/ fitsim4/ fitsim5/ fitsim6/ ... \
                            --samples 1000 \
                            --parameter PhoIndex \
                            --out posterior_samples.txt
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('load_ultranest_outputs.py fitsim0/ fitsim1/ fitsim2/ fitsim3/ fitsim4/ fitsim5/ fitsim6/ ... --samples 1000 --parameter PhoIndex --out posterior_samples.txt')"><i class="icofont-copy"></i></button>
          </li>
          <li>The <code>posterior_samples.txt</code> file contains 1000 sampled rows of each posterior.</li></br>
          <li><strong>Important</strong>: if the posterior samples were obtained with a non-uniform prior, the posterior samples should first be resampled according to the inverse of the prior that was used.</li></br>
          <li>Visualise the data by calculating the 16th, 50th & 84th quantiles of each posterior sample and plotting as an errorbar. E.g., in Python:</br>
<code><pre>
import <a target="_blank" href="https://numpy.org">numpy</a> as np
import <a target="_blank" href="https://pandas.pydata.org">pandas</a> as pd
quantiles = [16, 50, 84]
x = np.<a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.loadtxt.html">loadtxt</a>("posterior_samples.txt")
q = np.<a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.percentile.html">percentile</a>(x, quantiles, axis = 1)
df = pd.<a target="_blank" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html">DataFrame</a>(data = {"q%d" %(qvalue): q[i] for i, qvalue in enumerate(quantiles)})
          
import <a target="_blank" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.html">matplotlib.pyplot</a> as plt
plt.<a target="_blank" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xlabel.html">xlabel</a>("PhoIndex")
plt.<a target="_blank" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.errorbar.html">errorbar</a>(x=df["q50"], xerr=[df["q50"]-df["q16"], df["q84"]-df["q50"]], y=range(len(df)), marker="o", ls=" ", color="orange")
plt.<a target="_blank" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xlim.html">xlim</a>(df["q16"].min() - 0.5, df["q84"].max() + 0.5)
plt.<a target="_blank" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html">show</a>()
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('import numpy as np\nimport pandas as pd\nquantiles = [16, 50, 84]\nx = np.loadtxt(&quot;posterior_samples.txt&quot;)\nq = np.percentile(x, quantiles, axis = 1)\ndf = pd.DataFrame(data = {&quot;q%d&quot; %(qvalue): q[i] for i, qvalue in enumerate(quantiles)})\n\nimport matplotlib.pyplot as plt\nplt.xlabel(&quot;PhoIndex&quot;)\nplt.errorbar(x=df[&quot;q50&quot;], xerr=[df[&quot;q50&quot;]-df[&quot;q16&quot;], df[&quot;q84&quot;]-df[&quot;q50&quot;]], y=range(len\ndf)), marker=&quot;o&quot;, ls=&quot; &quot;, color=&quot;orange&quot;)\nplt.xlim(df[&quot;q16&quot;].min() - 0.5, df[&quot;q84&quot;].max() + 0.5)\nplt.show()')"><i class="icofont-copy"></i></button>
          <div class="col-lg-8">
            <img src="bxa//vis_samples.png" class="img-fluid" alt="">
          </div>
          </li>
          <li>Run <a target="_blank" href="https://github.com/JohannesBuchner/PosteriorStacker">PosteriorStacker</a>:<br>
          <code>$ <a target="_blank" href="https://github.com/JohannesBuchner/PosteriorStacker">posteriorstacker.py</a> posterior_samples.txt 0.5 3. 10 --name="PhoIndex"</code>
          &nbsp; <button class="cpbt" onclick="cx('posteriorstacker.py posterior_samples.txt 0.5 3. 10 --name=&quot;PhoIndex&quot;')"><i class="icofont-copy"></i></button>
          </li>
          <li><a target="_blank" href="https://github.com/JohannesBuchner/PosteriorStacker">PosteriorStacker</a> then fits two models for the parent sample distribution: a histogram model with each bin height as the free parameters (using a <a target="_blank" href="https://en.wikipedia.org/wiki/Dirichlet_distribution">Dirichlet prior</a>) and a Gaussian model with mean and sigma as the free parameters.</li></br>
          <li>Examine the <code>posteriorsamples.txt_out.pdf</code> file.</li></br>
          <li>What can you say about the distribution of <code>PhoIndex</code>? What would happen if you acquired more posterior samples (i.e. by increasing <code>population_size</code> in the simulation scripts) and/or used higher signal-to-noise spectra to fit?</li></br>

        </ul>
      </div>
</section>

<section id="ex24" class="services">
      <div class="container">
        <div class="section-title">
          <h3><i class="bx bx-chevron-right"></i> Exercise 2.4 - Bayesian Hierarchical Modelling continued (more challenging) <a class="headerlink" href="#ex24" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
          <p><em>Now you have created a parent population for photon index using PosteriorStacker, this exercise will focus on the <i>N</i><sub>H</sub> distribution.</em></p>
        </div>

        <i>Context:</i> The column density (<i>N</i><sub>H</sub>) distribution is a useful quantity for studies of accreting supermassive black holes (aka Active Galactic Nuclei; AGN).
          Of particular interest in this regard is the "Compton-thick" fraction - i.e. the fraction of sources with log <i>N</i><sub>H</sub> / cm<sup>-2</sup> > 24.
        <br><br>
        <b>The goal of this exercise is to estimate how many individual AGN should be observed to constrain the Compton-thick fraction to a certain precision level.</b>
        <br><br>

        For the AGN being simulated, we can assume:
        <ul>
          <li>Every AGN follows the same baseline model:
            <br>
            <code>model = TBabs[Gal] * TBabs[AGN] * powerlaw</code>
            <br>
            Where:
            <ul>
              <li><code>TBabs[Gal]</code> is the absorbing column density arising from the Milky Way, assumed to be <i>N</i><sub>H</sub> = 10<sup>20</sup> cm<sup>-2</sup> for every AGN.
              </li>
              <li><code>TBabs[AGN]</code> is the absorbing column density at the source. This is the parameter we want to generate a population <i>N</i><sub>H</sub> distribution from.
              </li>
              <li><code>powerlaw</code> is the intrinsic emission from the AGN, with photon index within 1.9 &pm; 0.1 and normalisation within 10<sup>-4</sup> to 10<sup>-1</sup> photons/keV/cm<sup>2</sup>/s at 1 keV.
              </li>
              Note this assumes that every AGN is at redshift zero.
            </ul>
          </li>
          <li>Every AGN has a column density <i>N</i><sub>H</sub> in the range 10<sup>20</sup> - 10<sup>25</sup> cm<sup>-2</sup>. (Remember the units of <i>N</i><sub>H</sub> in <code>TBabs</code> is 10<sup>22</sup> cm<sup>-2</sup>!)
          </li>
          <li>Every AGN observation will be carried out by NuSTAR. Note the energy range for spectral analysis will be 3-78 keV, and you can assume observation exposures of 100 ks with no background present. Response (<code>nustar.rmf</code>) and effective area (<code>point_30arcsecRad_1arcminOA.arf</code>) files can be found in the <a href="https://www.nustar.caltech.edu/system/media_files/binaries/32/original/nustar_point_sources_for_proposers.tgz?1404172745">point source simulation files</a> (distributed by the NuSTAR team, more info <a target="_blank" href="https://www.nustar.caltech.edu/page/response_files">here</a>).
          </li>
          <li>The parent <i>N</i><sub>H</sub> distribution follows this shape:
            <br><br>
            <div class="col-lg-8">
              <img src="bxa/simnhdist.png" class="img-fluid" alt="">
            </div>
            <br>
            To generate <code>N</code> random log <i>N</i><sub>H</sub> values from this distribution, you can use the following code:
            <code><pre>
import scipy.interpolate
import numpy as np
np.random.seed(42)
fractions = [0.25, 0.05, 0.15, 0.2, 0.3]
bins = [20., 21., 22., 23., 24., 25.]
cdf = np.append(0., np.cumsum(fractions) / np.sum(fractions))
interp_cdf = scipy.interpolate.interp1d(cdf, bins, bounds_error = False)
rands = np.random.uniform(size = N)
random_lognh_values = interp_cdf(rands)
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('import scipy.interpolate\nimport numpy as np\nnp.random.seed(42)\nfractions = [0.25, 0.05, 0.15, 0.2, 0.3]\nbins = [20., 21., 22., 23., 24., 25.]\ncdf = np.append(0., np.cumsum(fractions) / np.sum(fractions))\ninterp_cdf = scipy.interpolate.interp1d(cdf, bins, bounds_error = False)\nrands = np.random.uniform(size = N)\nrandom_lognh_values = interp_cdf(rands)')"><i class="icofont-copy"></i></button>
          </li>
        </ul>

        Your challenge:
        <br>
        <ul>
          <li>Iteratively simulate spectra from the model described in the assumptions above, and re-fit the same model with BXA.</li>
          <li>By including each new spectrum that is simulated in turn, use the histogram model in PosteriorStacker to estimate the <i>N</i><sub>H</sub> distribution with the same bins as in the above plot.</li>
          <li>Find the number of sources required to constrain the log <i>N</i><sub>H</sub> = 24-25 bin with PosteriorStacker at the 20% relative uncertainty level.</li>
          <li>Can your <i>N</i><sub>H</sub> distribution constraints be improved? How could spectra below 3 keV help constrain the <i>N</i><sub>H</sub> distribution?</li>
        </ul>
          
      </div>
</section>



<section id="tipsandtricks" class="services">
      <div class="container">
        <div class="section-title">
          <h2><i class="bx bx-bulb"></i>Tips & tricks <a class="headerlink" href="#tipsandtricks" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
        </div>
        <ul>
          <li>
          To find the version of your bxa install:</br>
          <code><pre>
import <a target="_blank" href="https://github.com/JohannesBuchner/BXA">bxa</a>, <a target="_blank" href="https://nsoranzo-galaxy.readthedocs.io/en/stable/lib/pkg_resources.html">pkg_resources</a>
print(pkg_resources.<a target="_blank" href="https://nsoranzo-galaxy.readthedocs.io/en/stable/_modules/pkg_resources.html#get_distribution">get_distribution</a>("bxa").version)
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('import bxa, pkg_resources\nprint(pkg_resources.get_distribution(&quot;bxa&quot;).version)')"><i class="icofont-copy"></i></button>
          </li></br>
          <li>For complex fits (e.g., multiple datasets simultaneously, many parameters, high signal-to-noise spectra, ...), the run time can be decreased with e.g.,:</br>
            <ul>
          <li><code>results = solver.<a target="_blank" href="https://johannesbuchner.github.io/BXA/bxa.xspec.html#bxa.xspec.solver.BXASolver.run">run</a>(frac_remain=0.5, max_num_improvement_loops=0)</code> <button class="cpbt" onclick="cx('results = solver.run(frac_remain=0.5, max_num_improvement_loops=0)')"><i class="icofont-copy"></i></button>
            <br>
            <ul>
            <li><code>frac_remain</code> sets the cut-off condition for the integration. A low value is optimal for finding peaks but higher values (e.g., 0.5) can be used if the posterior distribution is a relatively simple shape.
            </li>
            <li><code>max_num_improvement_loops</code> sets the number of times <code>run()</code> will try to iteratively assess how many more samples are needed.
            </li>
            <li>To see the other arguments of <code>run()</code>, see <a href="https://johannesbuchner.github.io/UltraNest/ultranest.html#module-ultranest.integrator" target="_blank">here</a>.
            </li>
          </ul>
          <!-- <li>Step-samplers</li> -->
          </li></br>
          <li>If you're sure you want to, you can use BXA with chi-squared statistics:</br>
          <code>bxa.BXASolver.allowed_stats.append("chi2")</code>&nbsp; <button class="cpbt" onclick="cx('bxa.BXASolver.allowed_stats.append(&quot;chi2&quot;)')"><i class="icofont-copy"></i></button>
          </li></br>

          <li>You can create custom priors in BXA with <code><a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/5a6ee5fafbaf7bc609a29dafadae48d27aba50aa/bxa/xspec/priors.py#L75">create_custom_prior_for</a>()</code> (example taken from <a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/master/examples/xspec/example_advanced_priors.py">example_advanced_prior.py</a>):</br>
          PyXspec:<br>
          <code><pre>
def <a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/master/examples/xspec/example_advanced_priors.py#L27">my_custom_prior</a>(u):
    # prior distributions transform from 0:1 to the parameter range
    # here: a gaussian prior distribution, cut below 1/above 3
    x = <a target="_blank" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.norm.html">scipy.stats.norm</a>(1.9, 0.15).ppf(u)
    if x < 1.:
        x = 1
    if x > 3:
        x = 3
    return x
transformations = [bxa.<a target="_blank" href="https://github.com/JohannesBuchner/BXA/blob/5a6ee5fafbaf7bc609a29dafadae48d27aba50aa/bxa/xspec/priors.py#L75">create_custom_prior_for</a>(model, parameter, my_custom_prior)]
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('def my_custom_prior(u):\n    # prior distributions transform from 0:1 to the parameter range\n    # here: a gaussian prior distribution, cut below 1/above 3\n    x = scipy.stats.norm(1.9, 0.15).ppf(u)\n    if x < 1.:\n        x = 1\n    if x > 3:\n        x = 3\n    return x\ntransformations = [bxa.create_custom_prior_for(model, parameter, my_custom_prior)]')"><i class="icofont-copy"></i></button>
          </li><br>

          <li>You can use BXA with Sherpa to fit 2D models to images:</br>
              <code><pre>
import bxa.sherpa as bxa
<a target="_blank" href="https://cxc.harvard.edu/sherpa/ahelp/load_image.html">load_image</a>("image.fits")
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/image_data.html">image_data</a>()
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_coord.html">set_coord</a>("physical")
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_stat.html">set_stat</a>("cash")
model = <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/gauss2d.html">gauss2d</a>.g1 + <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/gauss2d.html">gauss2d</a>.g2 + <a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/const2d.html">const2d</a>.bg
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_source.html">set_source</a>(model)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/set_par.html">set_par</a>(g1.ampl, val = 20., min = 1., max = 1.e2)
...
parameters = [g1.ampl, ...]
priors = [bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/priors.html#create_loguniform_prior_for">create_loguniform_prior_for</a>(g1.ampl), ...]
priorfunction = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/sherpa/priors.html#create_prior_function">create_prior_function</a>(priors)
solver = bxa.<a target="_blank" href="https://johannesbuchner.github.io/BXA/sherpa-analysis.html#bxa.sherpa.solver.BXASolver">BXASolver</a>(prior=priorfunction, parameters=parameters, outputfiles_basename = "fit2d_sherpa")
results = solver.<a target="_blank" href="https://johannesbuchner.github.io/BXA/bxa.xspec.html#bxa.xspec.solver.BXASolver.run">run</a>(resume=True)
<a target="_blank" href="https://cxc.cfa.harvard.edu/sherpa/ahelp/image_data.html">image_data</a>()
<a target="_blank" href="https://cxc.harvard.edu/sherpa/ahelp/image_model.html">image_model</a>(newframe=True)
<a target="_blank" href="https://cxc.harvard.edu/sherpa4.6/ahelp/image_resid.html">image_resid</a>(newframe=True)
</pre></code>&nbsp; <button class="cpbt" onclick="cx('import bxa.sherpa as bxa\nload_image(&quot;image.fits&quot;)\nimage_data()\nset_coord(&quot;physical&quot;)\nset_stat(&quot;cash&quot;)\nmodel = gauss2d.g1 + gauss2d.g2 + const2d.bg\nset_source(model)\nset_par(g1.ampl, val = 20., min = 1., max = 1.e2)\n...\nparameters = [g1.ampl, ...]\npriors = [bxa.create_loguniform_prior_for(g1.ampl), ...]\npriorfunction = bxa.create_prior_function(priors)\nsolver = bxa.BXASolver(prior=priorfunction, parameters=parameters, outputfiles_basename = &quot;fit2d_sherpa&quot;)\nresults = solver.run(resume=True)\nimage_data()\nimage_model(newframe=True)\nimage_resid(newframe=True)')"><i class="icofont-copy"></i></button>
<br><br>
              Here is an example fit to the image used in <a target="_blank" href="https://cxc.harvard.edu/sherpa/threads/spatial/">this Sherpa tutorial for 2D fitting</a> (left, middle and right panels show the image, best-fit model and residuals respectively):
              <br><br>
              <div class="col-lg-8">
                <img src="bxa/ds9_fit2d_sherpa.png" class="img-fluid" alt="">
              </div>
          </li></br>
          
        </ul>
        </div>
</section>

<section id="contact" class="contact">
      <div class="container">

        <div class="section-title">
          <h2><i class="bx bx-envelope"></i> Contact</a> <a class="headerlink" href="#contact" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
        </div>

                <div class="row">

          <div class="col-lg-6">
            <div class="info">
                  <i class="icofont-question"></i>
                <h4>Raising issues</h4>
                <br>
                <ul>
                  <li>BXA: <a href="https://github.com/JohannesBuchner/BXA/issues" target="_blank">github.com/JohannesBuchner/BXA/issues</a></li>
                  <li>UltraNest: <a href="https://github.com/JohannesBuchner/UltraNest/issues" target="_blank">github.com/JohannesBuchner/UltraNest/issues</a></li>

              </div>
            </div>

          <div class="col-lg-6">
            <div class="info">
              <i class="icofont-envelope"></i>
                <h4>Email</h4>
                <br>
                <ul>
                  <li>Peter Boorman: <a href="mailto:boorman@asu.cas.cz">boorman@asu.cas.cz</li>
                  <li>Johannes Buchner: <a href="mailto:jbuchner@mpe.mpg.de">jbuchner@mpe.mpg.de</a></li>
                  <br>
            </div>
            </div>
          </div>


          
      </div>
</section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="social-links mt-3 text-left">
          <a href="https://peterboorman.com"><i class="bx bx-arrow-back"></i></a>
        </div>
      <!-- <div class="copyright">
        <a target="_blank" href="https://peterboorman.com"><i class="bx bx-arrow-back"></i> </a>
      </div> -->
      <!-- <div class="credits"> -->
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/ -->
        <!-- Design: <a href="https://bootstrapmade.com/">BootstrapMade</a> -->
      <!-- </div> -->
    </div>
  </footer>
  <!-- End  Footer -->

  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
  <script src="assets/vendor/counterup/counterup.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/venobox/venobox.min.js"></script>
  <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="assets/vendor/typed.js/typed.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

  <script src="assets/js/scroll.js"></script>

  <script>
    // https://stackoverflow.com/questions/67016340/javascript-copy-to-clipboard-without-concrete-id-in-html-tag
    function cp(id) {
  if (!id) return;
  const code = document.getElementById(id);
  if (!code) return;
  if (navigator && navigator.clipboard) { // need to check because it's only available on https and localohost
    navigator.clipboard.writeText(code.innerHTML);
  }
};
  </script>

  <script>
    // https://stackoverflow.com/questions/67016340/javascript-copy-to-clipboard-without-concrete-id-in-html-tag
    function cx(tx) {
  if (!tx) return;
  if (navigator && navigator.clipboard) { // need to check because it's only available on https and localohost
    navigator.clipboard.writeText(tx);
  }
};
  </script>
</body>

</html>