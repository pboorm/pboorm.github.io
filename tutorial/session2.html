<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Using academicons -->
  <!-- <link rel="stylesheet" href="../assets/academicons-1.9/css/academicons.min.css"/> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <!-- Using fontawesome -->
  <script src="https://kit.fontawesome.com/f5e5434f52.js" crossorigin="anonymous"></script>


  <!-- <link rel="apple-touch-icon" href="./favicon.ico" /> -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Session 2</title>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
  <!-- <meta content="" name="description"> -->
  <!-- <meta content="" name="keywords"> -->
  <meta property="og:title" content="BXA Tutorial Session 2" />
  <meta property="og:locale" content="en_UK" />
  <meta name="description" content="BXA Tutorial Session 2" />
  <meta property="og:description" content="BXA Tutorial Session 2" />
  <link rel="canonical" href="https://peterboorman.com/" />
  <meta property="og:url" content="https://peterboorman.com/" />
  <meta property="og:site_name" content="BXA Tutorial Session 2" />
  <script type="application/ld+json">
  {"@type":"WebSite","headline":"BXA Tutorial Session 2","url":"https://peterboorman.com/tutorial_bxa.html","description":"BXA Tutorial Session 2","name":"BXA Tutorial Session 2","@context":"https://schema.org"}</script>

  <!-- Favicons -->
  <!-- <link href="../assets/img/favicon.png" rel="icon"> -->
  <link href="favicon.ico" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="../assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: iPortfolio - v1.4.1
  * Template URL: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <div class="progressContainer"><div id="progress" class="progress"></div></div>


  <!-- ======= Mobile nav toggle button ======= -->
  <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">
      <div class="profile">
        <a href="../tutorial_bxa.html"><img src="../figures/plots_logo.png" alt="" class="img-fluid rounded-circle"></img></a>
        <p></p>
        <h1 class="specific"><a href="#session0">Session 2</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="http://johannesbuchner.github.io/BXA/" class="github"><i class="bx bxl-github"></i></a>
          <a href="../tutorial_bxa.html#contact"><i class="bx bx-envelope"></i></a>
        </div>
      </div>

      <nav class="nav-menu">
        <ul>
          <li><a href="../tutorial_bxa.html#welcome"><i class="bx bx-star"></i> <span>Welcome</span></a></li>
          <li><a href="whybxa.html"><i class="icofont-light-bulb"></i> <span>Why use BXA?</span></a></li>
          <li><a href="setup.html"><i class="icofont-tools-alt-2"></i> <span>Setup</span></a></li>
          <li><a href="setup.html#download"><i class="bx bx-download"></i> <span>Download spectra</span></a></li>
          <li><a href="session0.html"><i class="bx bx-terminal"></i>Session 0 - X-ray spectral fitting</a></li>
          <li><a href="session0.html#ex01"><i class="bx bx-chevron-right"></i>0.1 - binning data</a></li>
          <li><a href="session0.html#ex02"><i class="bx bx-chevron-right"></i>0.2 - loading data</a></li>
          <li><a href="session0.html#ex03"><i class="bx bx-chevron-right"></i>0.3 - plotting</a></li>
          <li><a href="session0.html#ex04"><i class="bx bx-chevron-right"></i>0.4 - fitting</a></li>
          <li><a href="session0.html#ex05"><i class="bx bx-chevron-right"></i>0.5 - simulating data</a></li>
          <li><a href="session1.html"><i class="bx bx-line-chart"></i>Session 1 - BXA</a></li>
          <li><a href="session1.html#ex11"><i class="bx bx-chevron-right"></i>1.1 - prior predictive checks</a></li>
          <li><a href="session1.html#ex12"><i class="bx bx-chevron-right"></i>1.2 - fitting a model</a></li>
          <li><a href="session1.html#ex13"><i class="bx bx-chevron-right"></i>1.3 - fit some more models</a></li>
          <li><a href="session1.html#ex14"><i class="bx bx-chevron-right"></i>1.4 - error propagation</a></li>
          <li><a href="session1.html#ex15"><i class="bx bx-chevron-right"></i>1.5 - fit multiple datasets</a></li>
          <li><a href="session1.html#ex16"><i class="bx bx-chevron-right"></i>1.6 - background fitting</a></li>
          <li><a href="#session2"><i class="bx bx-check-circle"></i>Session 2 - model checking</a></li>
          <li><a href="#ex21"><i class="bx bx-chevron-right"></i>2.1 - visualisation</a></li>
          <li><a href="#ex22"><i class="bx bx-chevron-right"></i>2.2 - quantile-quantile checks</a></li>
          <li><a href="#ex23"><i class="bx bx-chevron-right"></i>2.3 - posterior predictive checks</a></li>
          <li><a href="session3.html"><i class="bx bx-select-multiple"></i>Session 3 - model comparison</a></li>
          <li><a href="session3.html#ex31"><i class="bx bx-chevron-right"></i>3.1 - Bayes factors</a></li>
          <li><a href="session3.html#ex32"><i class="bx bx-chevron-right"></i>3.2 - type I errors</a></li>
          <li><a href="session3.html#ex33"><i class="bx bx-chevron-right"></i>3.3 - type II errors</a></li>
          <li><a href="session3.html#ex34"><i class="bx bx-chevron-right"></i>3.4 - extension</a></li>
          <li><a href="session4.html"><i class="bx bx-bar-chart-alt-2"></i>Session 4 - parent distributions</a></li>
          <li><a href="session4.html#ex41"><i class="bx bx-chevron-right"></i>4.1 - Gaussian</a></li>
          <li><a href="session4.html#ex42"><i class="bx bx-chevron-right"></i>4.2 - histogram</a></li>
          <li><a href="session4.html#ex43"><i class="bx bx-chevron-right"></i>4.3 - preparing for a proposal</a></li>
          <li><a href="session5.html"><i class="bx bx-analyse"></i>Session 5 - advanced usage</a></li>
          <li><a href="session5.html#ex51"><i class="bx bx-chevron-right"></i>5.1 - information gain</a></li>
          <li><a href="session5.html#ex52"><i class="bx bx-chevron-right"></i>5.2 - custom priors</a></li>
          <li><a href="session5.html#ex53"><i class="bx bx-chevron-right"></i>5.3 - step samplers</a></li>
          <li><a href="tipsandtricks.html"><i class="bx bx-bulb"></i> <span>Tips & tricks</span></a></li>
          <li><a href="links.html"><i class="bx bx-bookmarks"></i> <span>Useful links</span></a></li>
          <li><a href="#contact"><i class="icofont-letter"></i>Contact</a></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
          <li><p>&nbsp; </p></li>
        </ul>
      </nav><!-- .nav-menu -->
      <button type="button" class="mobile-nav-toggle d-xl-none"><i class="icofont-navigation-menu"></i></button>

    </div>
    </div>
  </header><!-- End Header -->

  <main id="main">


<section id="session2" class="services">
      <div class="container">
        <div class="section-title">
          <a class="collapselink" data-toggle="collapse" href="#collapse-session2" aria-expanded="true" aria-controls="collapse-session2" style="color: #173b6c;">
          <h2><i class="bx bx-check-circle"></i> Session 2 - model checking <a class="headerlink" href="#session2" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
          </a>
          </div>
          <div class="collapse show" id="collapse-session2">
          After fitting a model to the data, how can you check the quality of the fit? This session delves into a variety of ways to examine your fits and check that the model is able to explain the data to a satisfactory level.
          </br></br>
          Key objectives:
          <ul>
          <li>Learn how to plot the posterior model with the data</li>
          <li>Visualise goodness-of-fit without requiring the data to be re-binned</li>
          <li>Compare predicted model counts to observed counts to estimate goodness-of-fit</li>
        </ul>
        
        </div>
</section>


<section id="ex21" class="services">
      <div class="container">
        <div class="section-title">
          <a class="collapselink" data-toggle="collapse" href="#collapse-ex21" aria-expanded="true" aria-controls="collapse-ex21" style="color: #173b6c;">
          <h3><i class="bx bx-chevron-right"></i> Exercise 2.1 - visualisation <a class="headerlink" href="#ex21" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
          <em>Not everything needs to be a test. Visualisation can help check our model makes sense, that the fit worked and to infer information on the source being fit.</em>
        </a>
        </div>
        <div class="collapse show" id="collapse-ex21">
        </br>

        <ul>
          <li> First, examine the corner and trace plots that BXA produces (located in <code>outputfiles_basename/plots/</code>). What do these plots show?</li></br>

          <li>Are there any parameter degeneracies? Why or why not?</li></br>

          <li>Next, save the spectral realisations corresponding to each row of the posterior into a pandas dataframe. This will enable us to plot the convolved posterior spectrum. If you want to plot the convolved posterior for Chandra and NuSTAR, you can pass the data group number to the <code>Plot</code> commands as e.g., <code>Plot.y(2)</code>.
<code><pre>
Xset.restore("%s/model.xcm" %(outputfiles_basename))
Plot("ldata")
spec_df = pd.DataFrame(data = {"E_keV": Plot.x(1), "E_keV_err": Plot.xErr(1), "ldata": Plot.y(1), "ldata_err": Plot.yErr(1), "model_bestfit": Plot.model(1)})
for i, row in posterior_df[posterior_df.columns.iterrows():
    <a target="_blank" href="https://johannesbuchner.github.io/BXA/_modules/bxa/xspec/solver.html#set_parameters">set_parameters</a>(transformations=solver.transformations, values=row.values)
    Plot("ldata")
    spec_realisation = pd.<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html" target="_blank">(data = {"m_%d" %(i): Plot.model(1)})
    spec_df = pd.<a href="https://pandas.pydata.org/docs/reference/api/pandas.concat.html" target="_blank">pd.concat</a>([spec_df, spec_realisation], axis=1)
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('Xset.restore(&quot;%s/model.xcm&quot; %(outputfiles_basename))\nPlot(&quot;ldata&quot;)\nspec_df = pd.DataFrame(data = {&quot;E_keV&quot;: Plot.x(1), &quot;E_keV_err&quot;: Plot.xErr(1), &quot;ldata&quot;: Plot.y(1), &quot;ldata_err&quot;: Plot.yErr(1), &quot;model_bestfit&quot;: Plot.model(1)})\nfor i, row in posterior_df[posterior_df.columns.iterrows():\n    set_parameters(transformations=solver.transformations, values=row.values)\n    Plot(&quot;ldata&quot;)\n    spec_realisation = pd.(data = {&quot;m_%d&quot; %(i): Plot.model(1)})\n    spec_df = pd.pd.concat([spec_df, spec_realisation], axis=1)')"><i class="icofont-copy"></i></button>
          </li></br>

          <li>Use <code>PredictionBand</code> in <code>ultranest.plot</code> to overplot the posterior spectral range onto the data.
<code><pre>
</pre></code>
&nbsp; <button class="cpbt" onclick="cx('')"><i class="icofont-copy"></i></button>
          </li></br>

          <li>Does the model do a good job of explaining the data? Why or why not?</li>

          </ul>
      </div>
</section>


<section id="ex22" class="services">
      <div class="container">
        <div class="section-title">
          <a class="collapselink" data-toggle="collapse" href="#collapse-ex22" aria-expanded="true" aria-controls="collapse-ex22" style="color: #173b6c;">
          <h3><i class="bx bx-chevron-right"></i> Exercise 2.2 - Quantile-Quantile (Q-Q) plots <a class="headerlink" href="#ex22" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
        </a>
        </div>
        <div class="collapse show" id="collapse-ex22">
          <ul>
          <li> A useful way to visualise the plot is with Quantile-Quantile plots -- i.e. the cumulative observed counts vs. the cumulative predicted model counts. The benefit of using cumulative counts is that the data does not need to be binned more than it already has been.</li></br>

          <li>First produce the Q-Q plot for each of the BXA-derived best-fit spectral models for <code>model1</code>. Make sure to plot the total detected counts on both axes.
            <ul>
            <li>PyXspec:</br>
              <code><pre>
src_counts = np.array(Plot.y(1)) * 2. * np.array(Plot.xErr(1))
bkg_counts = np.array(Plot.backgroundVals(1)) * 2. * np.array(Plot.xErr(1))
mod_counts = np.array(Plot.model(1)) * 2. * np.array(Plot.xErr(1))</pre></code>
&nbsp; <button class="cpbt" onclick="cx('src_counts = np.array(Plot.y(1)) * 2. * np.array(Plot.xErr(1))\nbkg_counts = np.array(Plot.backgroundVals(1)) * 2. * np.array(Plot.xErr(1))\nmod_counts = np.array(Plot.model(1)) * 2. * np.array(Plot.xErr(1))')"><i class="icofont-copy"></i></button>
          </li>
          </ul>
          </li></br>

          <li>Plot alternative Q-Q plots for each model with spectral energy against the difference between cumulative data and cumulative model counts. Do all the models explain the data in a satisfactory way? Why or why not?</li></br>

          <li>The best-fit model is only part of the story. By saving the individual cumulative model realisations (similar to <a href="#ex21">Exercise 2.1</a>), plot Q-Q and Q-Q-difference plots with the posterior model ranges shown.</li></br>

          <li>Repeat the above exercises for <code>model2</code> and <code>model3</code>.
          </ul>
      </div>
    </div>
</section>


<section id="ex23" class="services">
      <div class="container">
        <div class="section-title">
          <a class="collapselink" data-toggle="collapse" href="#collapse-ex23" aria-expanded="true" aria-controls="collapse-ex23" style="color: #173b6c;">
          <h3><i class="bx bx-chevron-right"></i> Exercise 2.3 - posterior predictive checks <a class="headerlink" href="#ex23" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h3>
        <em>The model fit will never be perfect. But at what level are deviations from a perfect fit significant?</em>
        </a>
        </div>
        <div class="collapse show" id="collapse-ex23">
          <ul>
            <li>For <code>model1</code>, load the best-fit model and simulate a new spectrum from it. See <a href="session0.html#ex05">Exercise 0.5</a> for information about simulating a spectrum. Make sure to re-bin the new source spectrum with the same method as your real source spectrum.</li></br>

            <li>Repeat the simulation process for a large number of simulations, and save the fit statistic on each iteration. You can use a few different posterior rows also to ensure the scatter is realistic.
              <ul>
                <li>PyXspec:</br>
                  <code><pre>
fitstat = Fit.statistic</pre></code>
&nbsp; <button class="cpbt" onclick="cx('fitstat = Fit.statistic')"><i class="icofont-copy"></i></button>
              </ul>
            </li></br>
            <li>Plot the distribution of fit statistics together with the fit statistic from the best-fit.</li></br>

            <li>Now instead of just saving the fit statistic on each iteration, save the data required for the Q-Q plot (i.e. source, background and model counts as well as energy).</li></br>

            <li>Plot the Q-Q and Q-Q-difference plots as in <a href="#ex22">Exercise 2.2</a>, but include the posterior range that you have generated with simulations.</li></br>

            <li>Repeat this process for <code>model2</code> and <code>model3</code>. What can you say about the deviations from a perfect fit for each model?</li>

          </ul>
      </div>
    </div>
</section>


<section id="nav" class="contact">
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
            <div class="info">
                <a href="session1.html"><h4>Previous: Session 1</h4></a>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="info">
                <a href="session3.html"><h4>Next: Session 3</h4></a>
            </div>
          </div>
        </div>
      </div>
</section>


<section id="contact" class="contact">
      <div class="container">

        <div class="section-title">
          <a class="collapselink" data-toggle="collapse" href="#collapse-contact" aria-expanded="true" aria-controls="collapse-contact" style="color: #173b6c;">
          <h2><i class="bx bx-envelope"></i> Contact</a> <a class="headerlink" href="#contact" title="Permalink to this headline" style="font-size: 20px;"><i class="icofont-link-alt"></i></a></h2>
        </a>
        </div>
        <div class="collapse show" id="collapse-contact">

                <div class="row">

          <div class="col-lg-6">
            <div class="info">
                  <i class="icofont-question"></i>
                <h4>Raising issues</h4>
                <br>
                <ul>
                  <li>BXA: <a href="https://github.com/JohannesBuchner/BXA/issues" target="_blank">github.com/JohannesBuchner/BXA/issues</a></li>
                  <li>UltraNest: <a href="https://github.com/JohannesBuchner/UltraNest/issues" target="_blank">github.com/JohannesBuchner/UltraNest/issues</a></li>

              </div>
            </div>

          <div class="col-lg-6">
            <div class="info">
              <i class="icofont-envelope"></i>
                <h4>Email</h4>
                <br>
                <ul>
                  <li>Peter Boorman: <a href="mailto:boorman[at]asu[dot]cas[dot]cz">boorman[at]asu[dot]cas[dot]cz</a></li>
                  <li>Johannes Buchner: <a href="mailto:jbuchner[at]mpe[dot]mpg[dot]de">jbuchner[at]mpe[dot]mpg[dot]de</a></li>
                </ul>
            </div>
            </div>
          </div>


          
      </div>
</section>



  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="social-links mt-3 text-left">
          <a href="../tutorial_bxa.html"><i class="bx bx-home-alt"></i></a>
        </div>
      <!-- <div class="copyright">
        <a target="_blank" href="https://peterboorman.com"><i class="bx bx-arrow-back"></i> </a>
      </div> -->
      <!-- <div class="credits"> -->
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/ -->
        <!-- Design: <a href="https://bootstrapmade.com/">BootstrapMade</a> -->
      <!-- </div> -->
    </div>
  </footer>
  <!-- End  Footer -->

  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/jquery/jquery.min.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>
  <script src="../assets/vendor/waypoints/jquery.waypoints.min.js"></script>
  <script src="../assets/vendor/counterup/counterup.min.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/venobox/venobox.min.js"></script>
  <script src="../assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="../assets/vendor/typed.js/typed.min.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>

  <script src="../assets/js/scroll.js"></script>

  <script>
    // https://stackoverflow.com/questions/67016340/javascript-copy-to-clipboard-without-concrete-id-in-html-tag
    function cp(id) {
  if (!id) return;
  const code = document.getElementById(id);
  if (!code) return;
  if (navigator && navigator.clipboard) { // need to check because it's only available on https and localohost
    navigator.clipboard.writeText(code.innerHTML);
  }
};
  </script>

  <script>
    // https://stackoverflow.com/questions/67016340/javascript-copy-to-clipboard-without-concrete-id-in-html-tag
    function cx(tx) {
  if (!tx) return;
  if (navigator && navigator.clipboard) { // need to check because it's only available on https and localohost
    navigator.clipboard.writeText(tx);
  }
};
  </script>
</body>

</html>